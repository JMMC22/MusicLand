'use strict';function cov_n1wo5ql9g(){var path="C:\\Users\\jmmar\\OneDrive\\Documentos\\Documents\\INGENIERIA INFORM\xC1TICA 4\xBA\\2DO CUATRIMESTRE\\TFG\\repo\\red-social\\api\\middlewares\\authenticated.js";var hash="fca3b559891313f9ee95b370b5e93cc50a1909a1";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\jmmar\\OneDrive\\Documentos\\Documents\\INGENIERIA INFORM\xC1TICA 4\xBA\\2DO CUATRIMESTRE\\TFG\\repo\\red-social\\api\\middlewares\\authenticated.js",statementMap:{"0":{start:{line:3,column:10},end:{line:3,column:31}},"1":{start:{line:4,column:13},end:{line:4,column:30}},"2":{start:{line:5,column:13},end:{line:5,column:34}},"3":{start:{line:8,column:0},end:{line:35,column:1}},"4":{start:{line:9,column:4},end:{line:13,column:5}},"5":{start:{line:10,column:8},end:{line:12,column:10}},"6":{start:{line:15,column:16},end:{line:15,column:63}},"7":{start:{line:17,column:4},end:{line:30,column:5}},"8":{start:{line:18,column:22},end:{line:18,column:47}},"9":{start:{line:20,column:8},end:{line:24,column:9}},"10":{start:{line:21,column:12},end:{line:23,column:15}},"11":{start:{line:27,column:8},end:{line:29,column:11}},"12":{start:{line:32,column:4},end:{line:32,column:23}},"13":{start:{line:34,column:4},end:{line:34,column:11}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:21},end:{line:8,column:22}},loc:{start:{line:8,column:47},end:{line:35,column:1}},line:8}},branchMap:{"0":{loc:{start:{line:9,column:4},end:{line:13,column:5}},type:"if",locations:[{start:{line:9,column:4},end:{line:13,column:5}},{start:{line:9,column:4},end:{line:13,column:5}}],line:9},"1":{loc:{start:{line:20,column:8},end:{line:24,column:9}},type:"if",locations:[{start:{line:20,column:8},end:{line:24,column:9}},{start:{line:20,column:8},end:{line:24,column:9}}],line:20}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},f:{"0":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"fca3b559891313f9ee95b370b5e93cc50a1909a1"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_n1wo5ql9g=function(){return actualCoverage;};return actualCoverage;}cov_n1wo5ql9g();var jwt=(cov_n1wo5ql9g().s[0]++,require('jwt-simple'));var moment=(cov_n1wo5ql9g().s[1]++,require('moment'));var secret=(cov_n1wo5ql9g().s[2]++,'clave_secreta_QNnN3');cov_n1wo5ql9g().s[3]++;exports.ensureAuth=function(req,res,next){cov_n1wo5ql9g().f[0]++;cov_n1wo5ql9g().s[4]++;if(!req.headers.authorization){cov_n1wo5ql9g().b[0][0]++;cov_n1wo5ql9g().s[5]++;return res.status(403).send({message:'La petición no tiene cabecera autenticación.'});}else{cov_n1wo5ql9g().b[0][1]++;}var token=(cov_n1wo5ql9g().s[6]++,req.headers.authorization.replace(/["']+/g,''));cov_n1wo5ql9g().s[7]++;try{var payload=(cov_n1wo5ql9g().s[8]++,jwt.decode(token,secret));cov_n1wo5ql9g().s[9]++;if(payload.exp<=moment().unix()){cov_n1wo5ql9g().b[1][0]++;cov_n1wo5ql9g().s[10]++;return res.status(401).send({message:'El token ha expirado.'});}else{cov_n1wo5ql9g().b[1][1]++;}}catch(ex){cov_n1wo5ql9g().s[11]++;return res.status(404).send({message:'El token no es válido.'});}cov_n1wo5ql9g().s[12]++;req.user=payload;cov_n1wo5ql9g().s[13]++;next();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0ZWQuanMiXSwibmFtZXMiOlsiand0IiwicmVxdWlyZSIsIm1vbWVudCIsInNlY3JldCIsImV4cG9ydHMiLCJlbnN1cmVBdXRoIiwicmVxIiwicmVzIiwibmV4dCIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3RhdHVzIiwic2VuZCIsIm1lc3NhZ2UiLCJ0b2tlbiIsInJlcGxhY2UiLCJwYXlsb2FkIiwiZGVjb2RlIiwiZXhwIiwidW5peCIsImV4IiwidXNlciJdLCJtYXBwaW5ncyI6IkFBQUEsYSx1dkVBRUEsR0FBSUEsQ0FBQUEsR0FBRyx5QkFBR0MsT0FBTyxDQUFDLFlBQUQsQ0FBVixDQUFQLENBQ0EsR0FBSUMsQ0FBQUEsTUFBTSx5QkFBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFWLENBQ0EsR0FBSUUsQ0FBQUEsTUFBTSx5QkFBRyxxQkFBSCxDQUFWLEMsdUJBR0FDLE9BQU8sQ0FBQ0MsVUFBUixDQUFxQixTQUFVQyxHQUFWLENBQWVDLEdBQWYsQ0FBb0JDLElBQXBCLENBQTBCLCtDQUMzQyxHQUFJLENBQUNGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxhQUFqQixDQUFnQyxrREFDNUIsTUFBT0gsQ0FBQUEsR0FBRyxDQUFDSSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsQ0FDeEJDLE9BQU8sQ0FBRSw4Q0FEZSxDQUFyQixDQUFQLENBR0gsQ0FKRCxnQ0FNQSxHQUFJQyxDQUFBQSxLQUFLLHlCQUFHUixHQUFHLENBQUNHLE9BQUosQ0FBWUMsYUFBWixDQUEwQkssT0FBMUIsQ0FBa0MsUUFBbEMsQ0FBNEMsRUFBNUMsQ0FBSCxDQUFULENBUDJDLHVCQVMzQyxHQUFJLENBQ0EsR0FBSUMsQ0FBQUEsT0FBTyx5QkFBR2hCLEdBQUcsQ0FBQ2lCLE1BQUosQ0FBV0gsS0FBWCxDQUFrQlgsTUFBbEIsQ0FBSCxDQUFYLENBREEsdUJBR0EsR0FBSWEsT0FBTyxDQUFDRSxHQUFSLEVBQWVoQixNQUFNLEdBQUdpQixJQUFULEVBQW5CLENBQW9DLG1EQUNoQyxNQUFPWixDQUFBQSxHQUFHLENBQUNJLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQixDQUN4QkMsT0FBTyxDQUFFLHVCQURlLENBQXJCLENBQVAsQ0FHSCxDQUpELGdDQU1ILENBQUMsTUFBT08sRUFBUCxDQUFXLHlCQUNULE1BQU9iLENBQUFBLEdBQUcsQ0FBQ0ksTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLENBQ3hCQyxPQUFPLENBQUUsd0JBRGUsQ0FBckIsQ0FBUCxDQUdILENBdEIwQyx3QkF3QjNDUCxHQUFHLENBQUNlLElBQUosQ0FBV0wsT0FBWCxDQXhCMkMsd0JBMEIzQ1IsSUFBSSxHQUNQLENBM0JEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXHJcblxyXG52YXIgand0ID0gcmVxdWlyZSgnand0LXNpbXBsZScpO1xyXG52YXIgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XHJcbnZhciBzZWNyZXQgPSAnY2xhdmVfc2VjcmV0YV9RTm5OMydcclxuXHJcblxyXG5leHBvcnRzLmVuc3VyZUF1dGggPSBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgIGlmICghcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbikge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuc2VuZCh7XHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdMYSBwZXRpY2nDs24gbm8gdGllbmUgY2FiZWNlcmEgYXV0ZW50aWNhY2nDs24uJ1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbi5yZXBsYWNlKC9bXCInXSsvZywgJycpO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgICAgdmFyIHBheWxvYWQgPSBqd3QuZGVjb2RlKHRva2VuLCBzZWNyZXQpO1xyXG5cclxuICAgICAgICBpZiAocGF5bG9hZC5leHAgPD0gbW9tZW50KCkudW5peCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuc2VuZCh7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnRWwgdG9rZW4gaGEgZXhwaXJhZG8uJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLnNlbmQoe1xyXG4gICAgICAgICAgICBtZXNzYWdlOiAnRWwgdG9rZW4gbm8gZXMgdsOhbGlkby4nXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVxLnVzZXIgPSBwYXlsb2FkO1xyXG5cclxuICAgIG5leHQoKTtcclxufSJdfQ==