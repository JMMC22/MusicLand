'use strict';function cov_fcwxfmrgb(){var path="C:\\Users\\jmmar\\OneDrive\\Documentos\\Documents\\INGENIERIA INFORM\xC1TICA 4\xBA\\2DO CUATRIMESTRE\\TFG\\repo\\red-social\\api\\controllers\\follow.js";var hash="8eec531ecf44e9ef7e84753c7a2909735af10727";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\jmmar\\OneDrive\\Documentos\\Documents\\INGENIERIA INFORM\xC1TICA 4\xBA\\2DO CUATRIMESTRE\\TFG\\repo\\red-social\\api\\controllers\\follow.js",statementMap:{"0":{start:{line:3,column:25},end:{line:3,column:55}},"1":{start:{line:5,column:11},end:{line:5,column:36}},"2":{start:{line:6,column:13},end:{line:6,column:40}},"3":{start:{line:9,column:17},end:{line:9,column:25}},"4":{start:{line:11,column:17},end:{line:11,column:29}},"5":{start:{line:12,column:4},end:{line:12,column:31}},"6":{start:{line:13,column:4},end:{line:13,column:38}},"7":{start:{line:15,column:4},end:{line:21,column:6}},"8":{start:{line:16,column:8},end:{line:16,column:83}},"9":{start:{line:16,column:17},end:{line:16,column:83}},"10":{start:{line:18,column:8},end:{line:18,column:106}},"11":{start:{line:18,column:27},end:{line:18,column:106}},"12":{start:{line:20,column:8},end:{line:20,column:62}},"13":{start:{line:25,column:17},end:{line:25,column:29}},"14":{start:{line:26,column:21},end:{line:26,column:34}},"15":{start:{line:28,column:4},end:{line:32,column:7}},"16":{start:{line:29,column:8},end:{line:29,column:89}},"17":{start:{line:29,column:17},end:{line:29,column:89}},"18":{start:{line:31,column:8},end:{line:31,column:80}},"19":{start:{line:36,column:17},end:{line:36,column:29}},"20":{start:{line:38,column:4},end:{line:40,column:5}},"21":{start:{line:39,column:8},end:{line:39,column:31}},"22":{start:{line:42,column:15},end:{line:42,column:16}},"23":{start:{line:44,column:4},end:{line:46,column:5}},"24":{start:{line:45,column:8},end:{line:45,column:31}},"25":{start:{line:48,column:23},end:{line:48,column:24}},"26":{start:{line:50,column:4},end:{line:67,column:10}},"27":{start:{line:52,column:12},end:{line:52,column:93}},"28":{start:{line:52,column:21},end:{line:52,column:93}},"29":{start:{line:54,column:12},end:{line:54,column:86}},"30":{start:{line:54,column:26},end:{line:54,column:86}},"31":{start:{line:56,column:12},end:{line:65,column:15}},"32":{start:{line:58,column:16},end:{line:64,column:19}},"33":{start:{line:72,column:20},end:{line:77,column:10}},"34":{start:{line:74,column:12},end:{line:74,column:29}},"35":{start:{line:76,column:12},end:{line:76,column:36}},"36":{start:{line:80,column:19},end:{line:85,column:10}},"37":{start:{line:82,column:12},end:{line:82,column:28}},"38":{start:{line:84,column:12},end:{line:84,column:36}},"39":{start:{line:88,column:26},end:{line:88,column:28}},"40":{start:{line:90,column:4},end:{line:92,column:7}},"41":{start:{line:91,column:8},end:{line:91,column:46}},"42":{start:{line:95,column:25},end:{line:95,column:27}},"43":{start:{line:97,column:4},end:{line:99,column:7}},"44":{start:{line:98,column:8},end:{line:98,column:41}},"45":{start:{line:101,column:4},end:{line:104,column:5}},"46":{start:{line:108,column:17},end:{line:108,column:29}},"47":{start:{line:110,column:4},end:{line:112,column:5}},"48":{start:{line:111,column:8},end:{line:111,column:31}},"49":{start:{line:114,column:15},end:{line:114,column:16}},"50":{start:{line:116,column:4},end:{line:118,column:5}},"51":{start:{line:117,column:8},end:{line:117,column:31}},"52":{start:{line:120,column:23},end:{line:120,column:24}},"53":{start:{line:122,column:4},end:{line:139,column:10}},"54":{start:{line:124,column:12},end:{line:124,column:87}},"55":{start:{line:124,column:21},end:{line:124,column:87}},"56":{start:{line:126,column:12},end:{line:126,column:86}},"57":{start:{line:126,column:26},end:{line:126,column:86}},"58":{start:{line:128,column:12},end:{line:137,column:15}},"59":{start:{line:130,column:16},end:{line:136,column:19}},"60":{start:{line:143,column:17},end:{line:143,column:29}},"61":{start:{line:145,column:4},end:{line:151,column:6}},"62":{start:{line:146,column:8},end:{line:146,column:83}},"63":{start:{line:146,column:17},end:{line:146,column:83}},"64":{start:{line:148,column:8},end:{line:148,column:82}},"65":{start:{line:148,column:22},end:{line:148,column:82}},"66":{start:{line:150,column:8},end:{line:150,column:48}},"67":{start:{line:155,column:17},end:{line:155,column:29}},"68":{start:{line:157,column:4},end:{line:163,column:6}},"69":{start:{line:158,column:8},end:{line:158,column:83}},"70":{start:{line:158,column:17},end:{line:158,column:83}},"71":{start:{line:160,column:8},end:{line:160,column:82}},"72":{start:{line:160,column:22},end:{line:160,column:82}},"73":{start:{line:162,column:8},end:{line:162,column:48}},"74":{start:{line:165,column:0},end:{line:174,column:1}}},fnMap:{"0":{name:"followSave",decl:{start:{line:8,column:9},end:{line:8,column:19}},loc:{start:{line:8,column:30},end:{line:22,column:1}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:16},end:{line:15,column:17}},loc:{start:{line:15,column:39},end:{line:21,column:5}},line:15},"2":{name:"unfollow",decl:{start:{line:24,column:9},end:{line:24,column:17}},loc:{start:{line:24,column:28},end:{line:33,column:1}},line:24},"3":{name:"(anonymous_3)",decl:{start:{line:28,column:67},end:{line:28,column:68}},loc:{start:{line:28,column:74},end:{line:32,column:5}},line:28},"4":{name:"getFollowingUsers",decl:{start:{line:35,column:9},end:{line:35,column:26}},loc:{start:{line:35,column:37},end:{line:68,column:1}},line:35},"5":{name:"(anonymous_5)",decl:{start:{line:51,column:38},end:{line:51,column:39}},loc:{start:{line:51,column:63},end:{line:67,column:9}},line:51},"6":{name:"(anonymous_6)",decl:{start:{line:56,column:39},end:{line:56,column:40}},loc:{start:{line:56,column:50},end:{line:65,column:13}},line:56},"7":{name:"followUserIds",decl:{start:{line:70,column:15},end:{line:70,column:28}},loc:{start:{line:70,column:38},end:{line:105,column:1}},line:70},"8":{name:"(anonymous_8)",decl:{start:{line:73,column:14},end:{line:73,column:15}},loc:{start:{line:73,column:29},end:{line:75,column:9}},line:73},"9":{name:"(anonymous_9)",decl:{start:{line:75,column:17},end:{line:75,column:18}},loc:{start:{line:75,column:26},end:{line:77,column:9}},line:75},"10":{name:"(anonymous_10)",decl:{start:{line:81,column:14},end:{line:81,column:15}},loc:{start:{line:81,column:28},end:{line:83,column:9}},line:81},"11":{name:"(anonymous_11)",decl:{start:{line:83,column:17},end:{line:83,column:18}},loc:{start:{line:83,column:26},end:{line:85,column:9}},line:83},"12":{name:"(anonymous_12)",decl:{start:{line:90,column:22},end:{line:90,column:23}},loc:{start:{line:90,column:34},end:{line:92,column:5}},line:90},"13":{name:"(anonymous_13)",decl:{start:{line:97,column:21},end:{line:97,column:22}},loc:{start:{line:97,column:33},end:{line:99,column:5}},line:97},"14":{name:"getFollowedUsers",decl:{start:{line:107,column:9},end:{line:107,column:25}},loc:{start:{line:107,column:36},end:{line:140,column:1}},line:107},"15":{name:"(anonymous_15)",decl:{start:{line:123,column:38},end:{line:123,column:39}},loc:{start:{line:123,column:63},end:{line:139,column:9}},line:123},"16":{name:"(anonymous_16)",decl:{start:{line:128,column:39},end:{line:128,column:40}},loc:{start:{line:128,column:50},end:{line:137,column:13}},line:128},"17":{name:"getMyFollows",decl:{start:{line:142,column:9},end:{line:142,column:21}},loc:{start:{line:142,column:32},end:{line:152,column:1}},line:142},"18":{name:"(anonymous_18)",decl:{start:{line:145,column:65},end:{line:145,column:66}},loc:{start:{line:145,column:83},end:{line:151,column:5}},line:145},"19":{name:"getMyFollowed",decl:{start:{line:154,column:9},end:{line:154,column:22}},loc:{start:{line:154,column:33},end:{line:164,column:1}},line:154},"20":{name:"(anonymous_20)",decl:{start:{line:157,column:69},end:{line:157,column:70}},loc:{start:{line:157,column:87},end:{line:163,column:5}},line:157}},branchMap:{"0":{loc:{start:{line:16,column:8},end:{line:16,column:83}},type:"if",locations:[{start:{line:16,column:8},end:{line:16,column:83}},{start:{line:16,column:8},end:{line:16,column:83}}],line:16},"1":{loc:{start:{line:18,column:8},end:{line:18,column:106}},type:"if",locations:[{start:{line:18,column:8},end:{line:18,column:106}},{start:{line:18,column:8},end:{line:18,column:106}}],line:18},"2":{loc:{start:{line:29,column:8},end:{line:29,column:89}},type:"if",locations:[{start:{line:29,column:8},end:{line:29,column:89}},{start:{line:29,column:8},end:{line:29,column:89}}],line:29},"3":{loc:{start:{line:38,column:4},end:{line:40,column:5}},type:"if",locations:[{start:{line:38,column:4},end:{line:40,column:5}},{start:{line:38,column:4},end:{line:40,column:5}}],line:38},"4":{loc:{start:{line:44,column:4},end:{line:46,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:46,column:5}},{start:{line:44,column:4},end:{line:46,column:5}}],line:44},"5":{loc:{start:{line:52,column:12},end:{line:52,column:93}},type:"if",locations:[{start:{line:52,column:12},end:{line:52,column:93}},{start:{line:52,column:12},end:{line:52,column:93}}],line:52},"6":{loc:{start:{line:54,column:12},end:{line:54,column:86}},type:"if",locations:[{start:{line:54,column:12},end:{line:54,column:86}},{start:{line:54,column:12},end:{line:54,column:86}}],line:54},"7":{loc:{start:{line:110,column:4},end:{line:112,column:5}},type:"if",locations:[{start:{line:110,column:4},end:{line:112,column:5}},{start:{line:110,column:4},end:{line:112,column:5}}],line:110},"8":{loc:{start:{line:116,column:4},end:{line:118,column:5}},type:"if",locations:[{start:{line:116,column:4},end:{line:118,column:5}},{start:{line:116,column:4},end:{line:118,column:5}}],line:116},"9":{loc:{start:{line:124,column:12},end:{line:124,column:87}},type:"if",locations:[{start:{line:124,column:12},end:{line:124,column:87}},{start:{line:124,column:12},end:{line:124,column:87}}],line:124},"10":{loc:{start:{line:126,column:12},end:{line:126,column:86}},type:"if",locations:[{start:{line:126,column:12},end:{line:126,column:86}},{start:{line:126,column:12},end:{line:126,column:86}}],line:126},"11":{loc:{start:{line:146,column:8},end:{line:146,column:83}},type:"if",locations:[{start:{line:146,column:8},end:{line:146,column:83}},{start:{line:146,column:8},end:{line:146,column:83}}],line:146},"12":{loc:{start:{line:148,column:8},end:{line:148,column:82}},type:"if",locations:[{start:{line:148,column:8},end:{line:148,column:82}},{start:{line:148,column:8},end:{line:148,column:82}}],line:148},"13":{loc:{start:{line:158,column:8},end:{line:158,column:83}},type:"if",locations:[{start:{line:158,column:8},end:{line:158,column:83}},{start:{line:158,column:8},end:{line:158,column:83}}],line:158},"14":{loc:{start:{line:160,column:8},end:{line:160,column:82}},type:"if",locations:[{start:{line:160,column:8},end:{line:160,column:82}},{start:{line:160,column:8},end:{line:160,column:82}}],line:160}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8eec531ecf44e9ef7e84753c7a2909735af10727"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_fcwxfmrgb=function(){return actualCoverage;};return actualCoverage;}cov_fcwxfmrgb();var mongoosePagination=(cov_fcwxfmrgb().s[0]++,require('mongoose-pagination'));var User=(cov_fcwxfmrgb().s[1]++,require('../models/user'));var Follow=(cov_fcwxfmrgb().s[2]++,require('../models/follow'));function followSave(req,res){cov_fcwxfmrgb().f[0]++;var params=(cov_fcwxfmrgb().s[3]++,req.body);var follow=(cov_fcwxfmrgb().s[4]++,new Follow());cov_fcwxfmrgb().s[5]++;follow.user=req.user.sub;cov_fcwxfmrgb().s[6]++;follow.followed=params.followed;cov_fcwxfmrgb().s[7]++;follow.save((err,followStored)=>{cov_fcwxfmrgb().f[1]++;cov_fcwxfmrgb().s[8]++;if(err){cov_fcwxfmrgb().b[0][0]++;cov_fcwxfmrgb().s[9]++;return res.status(500).send({message:'Error en la petición.'});}else{cov_fcwxfmrgb().b[0][1]++;}cov_fcwxfmrgb().s[10]++;if(!followStored){cov_fcwxfmrgb().b[1][0]++;cov_fcwxfmrgb().s[11]++;return res.status(404).send({message:'No se ha podido guardar el follow.'});}else{cov_fcwxfmrgb().b[1][1]++;}cov_fcwxfmrgb().s[12]++;return res.status(200).send({follow:followStored});});}function unfollow(req,res){cov_fcwxfmrgb().f[2]++;var userId=(cov_fcwxfmrgb().s[13]++,req.user.sub);var followedId=(cov_fcwxfmrgb().s[14]++,req.params.id);cov_fcwxfmrgb().s[15]++;Follow.find({'user':userId,'followed':followedId}).remove(err=>{cov_fcwxfmrgb().f[3]++;cov_fcwxfmrgb().s[16]++;if(err){cov_fcwxfmrgb().b[2][0]++;cov_fcwxfmrgb().s[17]++;return res.status(500).send({message:'Error al realizar unfollow.'});}else{cov_fcwxfmrgb().b[2][1]++;}cov_fcwxfmrgb().s[18]++;return res.status(200).send({message:'Se ha realizado el unfollow.'});});}function getFollowingUsers(req,res){cov_fcwxfmrgb().f[4]++;var userId=(cov_fcwxfmrgb().s[19]++,req.user.sub);cov_fcwxfmrgb().s[20]++;if(req.params.id){cov_fcwxfmrgb().b[3][0]++;cov_fcwxfmrgb().s[21]++;userId=req.params.id;}else{cov_fcwxfmrgb().b[3][1]++;}var page=(cov_fcwxfmrgb().s[22]++,1);cov_fcwxfmrgb().s[23]++;if(req.params.page){cov_fcwxfmrgb().b[4][0]++;cov_fcwxfmrgb().s[24]++;page=req.params.page;}else{cov_fcwxfmrgb().b[4][1]++;}var itemsPerPage=(cov_fcwxfmrgb().s[25]++,4);cov_fcwxfmrgb().s[26]++;Follow.find({user:userId}).populate({path:'followed'}).paginate(page,itemsPerPage,(err,follows,total)=>{cov_fcwxfmrgb().f[5]++;cov_fcwxfmrgb().s[27]++;if(err){cov_fcwxfmrgb().b[5][0]++;cov_fcwxfmrgb().s[28]++;return res.status(500).send({message:'Error al realizar unfollow.'});}else{cov_fcwxfmrgb().b[5][1]++;}cov_fcwxfmrgb().s[29]++;if(!follows){cov_fcwxfmrgb().b[6][0]++;cov_fcwxfmrgb().s[30]++;return res.status(404).send({message:'No hay follows.'});}else{cov_fcwxfmrgb().b[6][1]++;}cov_fcwxfmrgb().s[31]++;followUserIds(userId).then(value=>{cov_fcwxfmrgb().f[6]++;cov_fcwxfmrgb().s[32]++;return res.status(200).send({follows,users_following:value.following,users_followed:value.followed,total,pages:Math.ceil(total/itemsPerPage)});});});}async function followUserIds(user_id){cov_fcwxfmrgb().f[7]++;var following=(cov_fcwxfmrgb().s[33]++,await Follow.find({"user":user_id}).select({'_id':0,'__v':0,'user':0}).exec().then(following=>{cov_fcwxfmrgb().f[8]++;cov_fcwxfmrgb().s[34]++;return following;}).catch(err=>{cov_fcwxfmrgb().f[9]++;cov_fcwxfmrgb().s[35]++;return handleError(err);}));var followed=(cov_fcwxfmrgb().s[36]++,await Follow.find({"followed":user_id}).select({'_id':0,'__v':0,'followed':0}).exec().then(followed=>{cov_fcwxfmrgb().f[10]++;cov_fcwxfmrgb().s[37]++;return followed;}).catch(err=>{cov_fcwxfmrgb().f[11]++;cov_fcwxfmrgb().s[38]++;return handleError(err);}));//Procesando followings
var following_clean=(cov_fcwxfmrgb().s[39]++,[]);cov_fcwxfmrgb().s[40]++;following.forEach(follow=>{cov_fcwxfmrgb().f[12]++;cov_fcwxfmrgb().s[41]++;following_clean.push(follow.followed);});//Procesando followeds
var followed_clean=(cov_fcwxfmrgb().s[42]++,[]);cov_fcwxfmrgb().s[43]++;followed.forEach(follow=>{cov_fcwxfmrgb().f[13]++;cov_fcwxfmrgb().s[44]++;followed_clean.push(follow.user);});cov_fcwxfmrgb().s[45]++;return{following:following_clean,followed:followed_clean};}function getFollowedUsers(req,res){cov_fcwxfmrgb().f[14]++;var userId=(cov_fcwxfmrgb().s[46]++,req.user.sub);cov_fcwxfmrgb().s[47]++;if(req.params.id){cov_fcwxfmrgb().b[7][0]++;cov_fcwxfmrgb().s[48]++;userId=req.params.id;}else{cov_fcwxfmrgb().b[7][1]++;}var page=(cov_fcwxfmrgb().s[49]++,1);cov_fcwxfmrgb().s[50]++;if(req.params.page){cov_fcwxfmrgb().b[8][0]++;cov_fcwxfmrgb().s[51]++;page=req.params.page;}else{cov_fcwxfmrgb().b[8][1]++;}var itemsPerPage=(cov_fcwxfmrgb().s[52]++,4);cov_fcwxfmrgb().s[53]++;Follow.find({followed:userId}).populate({path:'user'}).paginate(page,itemsPerPage,(err,follows,total)=>{cov_fcwxfmrgb().f[15]++;cov_fcwxfmrgb().s[54]++;if(err){cov_fcwxfmrgb().b[9][0]++;cov_fcwxfmrgb().s[55]++;return res.status(500).send({message:'Error en la petición.'});}else{cov_fcwxfmrgb().b[9][1]++;}cov_fcwxfmrgb().s[56]++;if(!follows){cov_fcwxfmrgb().b[10][0]++;cov_fcwxfmrgb().s[57]++;return res.status(404).send({message:'No hay follows.'});}else{cov_fcwxfmrgb().b[10][1]++;}cov_fcwxfmrgb().s[58]++;followUserIds(userId).then(value=>{cov_fcwxfmrgb().f[16]++;cov_fcwxfmrgb().s[59]++;return res.status(200).send({follows,users_following:value.following,users_followed:value.followed,total,pages:Math.ceil(total/itemsPerPage)});});});}function getMyFollows(req,res){cov_fcwxfmrgb().f[17]++;var userId=(cov_fcwxfmrgb().s[60]++,req.user.sub);cov_fcwxfmrgb().s[61]++;Follow.find({user:userId}).populate('user followed').exec((err,follows)=>{cov_fcwxfmrgb().f[18]++;cov_fcwxfmrgb().s[62]++;if(err){cov_fcwxfmrgb().b[11][0]++;cov_fcwxfmrgb().s[63]++;return res.status(500).send({message:'Error en la petición.'});}else{cov_fcwxfmrgb().b[11][1]++;}cov_fcwxfmrgb().s[64]++;if(!follows){cov_fcwxfmrgb().b[12][0]++;cov_fcwxfmrgb().s[65]++;return res.status(404).send({message:'No hay follows.'});}else{cov_fcwxfmrgb().b[12][1]++;}cov_fcwxfmrgb().s[66]++;return res.status(200).send({follows});});}function getMyFollowed(req,res){cov_fcwxfmrgb().f[19]++;var userId=(cov_fcwxfmrgb().s[67]++,req.user.sub);cov_fcwxfmrgb().s[68]++;Follow.find({followed:userId}).populate('user followed').exec((err,follows)=>{cov_fcwxfmrgb().f[20]++;cov_fcwxfmrgb().s[69]++;if(err){cov_fcwxfmrgb().b[13][0]++;cov_fcwxfmrgb().s[70]++;return res.status(500).send({message:'Error en la petición.'});}else{cov_fcwxfmrgb().b[13][1]++;}cov_fcwxfmrgb().s[71]++;if(!follows){cov_fcwxfmrgb().b[14][0]++;cov_fcwxfmrgb().s[72]++;return res.status(404).send({message:'No hay follows.'});}else{cov_fcwxfmrgb().b[14][1]++;}cov_fcwxfmrgb().s[73]++;return res.status(200).send({follows});});}cov_fcwxfmrgb().s[74]++;module.exports={followSave,unfollow,getFollowingUsers,getFollowedUsers,getMyFollowed,getMyFollows};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvbGxvdy5qcyJdLCJuYW1lcyI6WyJtb25nb29zZVBhZ2luYXRpb24iLCJyZXF1aXJlIiwiVXNlciIsIkZvbGxvdyIsImZvbGxvd1NhdmUiLCJyZXEiLCJyZXMiLCJwYXJhbXMiLCJib2R5IiwiZm9sbG93IiwidXNlciIsInN1YiIsImZvbGxvd2VkIiwic2F2ZSIsImVyciIsImZvbGxvd1N0b3JlZCIsInN0YXR1cyIsInNlbmQiLCJtZXNzYWdlIiwidW5mb2xsb3ciLCJ1c2VySWQiLCJmb2xsb3dlZElkIiwiaWQiLCJmaW5kIiwicmVtb3ZlIiwiZ2V0Rm9sbG93aW5nVXNlcnMiLCJwYWdlIiwiaXRlbXNQZXJQYWdlIiwicG9wdWxhdGUiLCJwYXRoIiwicGFnaW5hdGUiLCJmb2xsb3dzIiwidG90YWwiLCJmb2xsb3dVc2VySWRzIiwidGhlbiIsInZhbHVlIiwidXNlcnNfZm9sbG93aW5nIiwiZm9sbG93aW5nIiwidXNlcnNfZm9sbG93ZWQiLCJwYWdlcyIsIk1hdGgiLCJjZWlsIiwidXNlcl9pZCIsInNlbGVjdCIsImV4ZWMiLCJjYXRjaCIsImhhbmRsZUVycm9yIiwiZm9sbG93aW5nX2NsZWFuIiwiZm9yRWFjaCIsInB1c2giLCJmb2xsb3dlZF9jbGVhbiIsImdldEZvbGxvd2VkVXNlcnMiLCJnZXRNeUZvbGxvd3MiLCJnZXRNeUZvbGxvd2VkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsYSxveFhBRUEsR0FBSUEsQ0FBQUEsa0JBQWtCLHlCQUFHQyxPQUFPLENBQUMscUJBQUQsQ0FBVixDQUF0QixDQUVBLEdBQUlDLENBQUFBLElBQUkseUJBQUdELE9BQU8sQ0FBQyxnQkFBRCxDQUFWLENBQVIsQ0FDQSxHQUFJRSxDQUFBQSxNQUFNLHlCQUFHRixPQUFPLENBQUMsa0JBQUQsQ0FBVixDQUFWLENBRUEsUUFBU0csQ0FBQUEsVUFBVCxDQUFvQkMsR0FBcEIsQ0FBeUJDLEdBQXpCLENBQThCLHdCQUMxQixHQUFJQyxDQUFBQSxNQUFN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SyxJQUFKLENBQVNDLEdBQVosQ0FBVixDQUQ2Qix3QkFHN0JSLE1BQU0sQ0FBQ29CLElBQVAsQ0FBWSxDQUFFWCxRQUFRLENBQUVRLE1BQVosQ0FBWixFQUFrQ1EsUUFBbEMsQ0FBMkMsZUFBM0MsRUFBNERnQixJQUE1RCxDQUFpRSxDQUFDOUIsR0FBRCxDQUFNaUIsT0FBTixHQUFrQixpREFDL0UsR0FBSWpCLEdBQUosQ0FBUywwREFBT1IsQ0FBQUEsR0FBRyxDQUFDVSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsQ0FBRUMsT0FBTyxDQUFFLHVCQUFYLENBQXJCLENBQVAsQ0FBa0UsQ0FBM0UsaUNBRCtFLHdCQUcvRSxHQUFJLENBQUNhLE9BQUwsQ0FBYywwREFBT3pCLENBQUFBLEdBQUcsQ0FBQ1UsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLENBQUVDLE9BQU8sQ0FBRSxpQkFBWCxDQUFyQixDQUFQLENBQTRELENBQTFFLGlDQUgrRSx3QkFLL0UsTUFBT1osQ0FBQUEsR0FBRyxDQUFDVSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsQ0FBRWMsT0FBRixDQUFyQixDQUFQLENBQ0gsQ0FORCxFQU9ILEMsd0JBQ0R1QixNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FFYm5ELFVBRmEsQ0FHYmUsUUFIYSxDQUliTSxpQkFKYSxDQUtiMEIsZ0JBTGEsQ0FNYkUsYUFOYSxDQU9iRCxZQVBhLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXHJcblxyXG52YXIgbW9uZ29vc2VQYWdpbmF0aW9uID0gcmVxdWlyZSgnbW9uZ29vc2UtcGFnaW5hdGlvbicpO1xyXG5cclxudmFyIFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvdXNlcicpO1xyXG52YXIgRm9sbG93ID0gcmVxdWlyZSgnLi4vbW9kZWxzL2ZvbGxvdycpO1xyXG5cclxuZnVuY3Rpb24gZm9sbG93U2F2ZShyZXEsIHJlcykge1xyXG4gICAgdmFyIHBhcmFtcyA9IHJlcS5ib2R5O1xyXG5cclxuICAgIHZhciBmb2xsb3cgPSBuZXcgRm9sbG93KCk7XHJcbiAgICBmb2xsb3cudXNlciA9IHJlcS51c2VyLnN1YjtcclxuICAgIGZvbGxvdy5mb2xsb3dlZCA9IHBhcmFtcy5mb2xsb3dlZDtcclxuXHJcbiAgICBmb2xsb3cuc2F2ZSgoZXJyLCBmb2xsb3dTdG9yZWQpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgZW4gbGEgcGV0aWNpw7NuLicgfSk7XHJcblxyXG4gICAgICAgIGlmICghZm9sbG93U3RvcmVkKSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLnNlbmQoeyBtZXNzYWdlOiAnTm8gc2UgaGEgcG9kaWRvIGd1YXJkYXIgZWwgZm9sbG93LicgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7IGZvbGxvdzogZm9sbG93U3RvcmVkIH0pO1xyXG4gICAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gdW5mb2xsb3cocmVxLCByZXMpIHtcclxuICAgIHZhciB1c2VySWQgPSByZXEudXNlci5zdWI7XHJcbiAgICB2YXIgZm9sbG93ZWRJZCA9IHJlcS5wYXJhbXMuaWQ7XHJcblxyXG4gICAgRm9sbG93LmZpbmQoeyAndXNlcic6IHVzZXJJZCwgJ2ZvbGxvd2VkJzogZm9sbG93ZWRJZCB9KS5yZW1vdmUoZXJyID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgYWwgcmVhbGl6YXIgdW5mb2xsb3cuJyB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHsgbWVzc2FnZTogJ1NlIGhhIHJlYWxpemFkbyBlbCB1bmZvbGxvdy4nIH0pXHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Rm9sbG93aW5nVXNlcnMocmVxLCByZXMpIHtcclxuICAgIHZhciB1c2VySWQgPSByZXEudXNlci5zdWI7XHJcblxyXG4gICAgaWYgKHJlcS5wYXJhbXMuaWQpIHtcclxuICAgICAgICB1c2VySWQgPSByZXEucGFyYW1zLmlkO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBwYWdlID0gMTtcclxuXHJcbiAgICBpZiAocmVxLnBhcmFtcy5wYWdlKSB7XHJcbiAgICAgICAgcGFnZSA9IHJlcS5wYXJhbXMucGFnZTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgaXRlbXNQZXJQYWdlID0gNDtcclxuXHJcbiAgICBGb2xsb3cuZmluZCh7IHVzZXI6IHVzZXJJZCB9KS5wb3B1bGF0ZSh7IHBhdGg6ICdmb2xsb3dlZCcgfSlcclxuICAgICAgICAucGFnaW5hdGUocGFnZSwgaXRlbXNQZXJQYWdlLCAoZXJyLCBmb2xsb3dzLCB0b3RhbCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgYWwgcmVhbGl6YXIgdW5mb2xsb3cuJyB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICghZm9sbG93cykgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5zZW5kKHsgbWVzc2FnZTogJ05vIGhheSBmb2xsb3dzLicgfSk7XHJcblxyXG4gICAgICAgICAgICBmb2xsb3dVc2VySWRzKHVzZXJJZCkudGhlbigodmFsdWUpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgIGZvbGxvd3MsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcnNfZm9sbG93aW5nOiB2YWx1ZS5mb2xsb3dpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcnNfZm9sbG93ZWQ6IHZhbHVlLmZvbGxvd2VkLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzOiBNYXRoLmNlaWwodG90YWwgLyBpdGVtc1BlclBhZ2UpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pXHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGZvbGxvd1VzZXJJZHModXNlcl9pZCkge1xyXG5cclxuICAgIHZhciBmb2xsb3dpbmcgPSBhd2FpdCBGb2xsb3cuZmluZCh7IFwidXNlclwiOiB1c2VyX2lkIH0pLnNlbGVjdCh7ICdfaWQnOiAwLCAnX192JzogMCwgJ3VzZXInOiAwIH0pLmV4ZWMoKVxyXG4gICAgICAgIC50aGVuKChmb2xsb3dpbmcpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGZvbGxvd2luZztcclxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcihlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICB2YXIgZm9sbG93ZWQgPSBhd2FpdCBGb2xsb3cuZmluZCh7IFwiZm9sbG93ZWRcIjogdXNlcl9pZCB9KS5zZWxlY3QoeyAnX2lkJzogMCwgJ19fdic6IDAsICdmb2xsb3dlZCc6IDAgfSkuZXhlYygpXHJcbiAgICAgICAgLnRoZW4oKGZvbGxvd2VkKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBmb2xsb3dlZDtcclxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBoYW5kbGVFcnJvcihlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIC8vUHJvY2VzYW5kbyBmb2xsb3dpbmdzXHJcbiAgICB2YXIgZm9sbG93aW5nX2NsZWFuID0gW107XHJcblxyXG4gICAgZm9sbG93aW5nLmZvckVhY2goKGZvbGxvdykgPT4ge1xyXG4gICAgICAgIGZvbGxvd2luZ19jbGVhbi5wdXNoKGZvbGxvdy5mb2xsb3dlZCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvL1Byb2Nlc2FuZG8gZm9sbG93ZWRzXHJcbiAgICB2YXIgZm9sbG93ZWRfY2xlYW4gPSBbXTtcclxuXHJcbiAgICBmb2xsb3dlZC5mb3JFYWNoKChmb2xsb3cpID0+IHtcclxuICAgICAgICBmb2xsb3dlZF9jbGVhbi5wdXNoKGZvbGxvdy51c2VyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZm9sbG93aW5nOiBmb2xsb3dpbmdfY2xlYW4sXHJcbiAgICAgICAgZm9sbG93ZWQ6IGZvbGxvd2VkX2NsZWFuXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEZvbGxvd2VkVXNlcnMocmVxLCByZXMpIHtcclxuICAgIHZhciB1c2VySWQgPSByZXEudXNlci5zdWI7XHJcblxyXG4gICAgaWYgKHJlcS5wYXJhbXMuaWQpIHtcclxuICAgICAgICB1c2VySWQgPSByZXEucGFyYW1zLmlkO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBwYWdlID0gMTtcclxuXHJcbiAgICBpZiAocmVxLnBhcmFtcy5wYWdlKSB7XHJcbiAgICAgICAgcGFnZSA9IHJlcS5wYXJhbXMucGFnZTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgaXRlbXNQZXJQYWdlID0gNDtcclxuXHJcbiAgICBGb2xsb3cuZmluZCh7IGZvbGxvd2VkOiB1c2VySWQgfSkucG9wdWxhdGUoeyBwYXRoOiAndXNlcicgfSlcclxuICAgICAgICAucGFnaW5hdGUocGFnZSwgaXRlbXNQZXJQYWdlLCAoZXJyLCBmb2xsb3dzLCB0b3RhbCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgZW4gbGEgcGV0aWNpw7NuLicgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWZvbGxvd3MpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCh7IG1lc3NhZ2U6ICdObyBoYXkgZm9sbG93cy4nIH0pO1xyXG5cclxuICAgICAgICAgICAgZm9sbG93VXNlcklkcyh1c2VySWQpLnRoZW4oKHZhbHVlKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBmb2xsb3dzLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJzX2ZvbGxvd2luZzogdmFsdWUuZm9sbG93aW5nLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJzX2ZvbGxvd2VkOiB2YWx1ZS5mb2xsb3dlZCxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbCxcclxuICAgICAgICAgICAgICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gaXRlbXNQZXJQYWdlKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRNeUZvbGxvd3MocmVxLCByZXMpIHtcclxuICAgIHZhciB1c2VySWQgPSByZXEudXNlci5zdWI7XHJcblxyXG4gICAgRm9sbG93LmZpbmQoeyB1c2VyOiB1c2VySWQgfSkucG9wdWxhdGUoJ3VzZXIgZm9sbG93ZWQnKS5leGVjKChlcnIsIGZvbGxvd3MpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgZW4gbGEgcGV0aWNpw7NuLicgfSk7XHJcblxyXG4gICAgICAgIGlmICghZm9sbG93cykgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5zZW5kKHsgbWVzc2FnZTogJ05vIGhheSBmb2xsb3dzLicgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7IGZvbGxvd3MgfSlcclxuICAgIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldE15Rm9sbG93ZWQocmVxLCByZXMpIHtcclxuICAgIHZhciB1c2VySWQgPSByZXEudXNlci5zdWI7XHJcblxyXG4gICAgRm9sbG93LmZpbmQoeyBmb2xsb3dlZDogdXNlcklkIH0pLnBvcHVsYXRlKCd1c2VyIGZvbGxvd2VkJykuZXhlYygoZXJyLCBmb2xsb3dzKSA9PiB7XHJcbiAgICAgICAgaWYgKGVycikgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5zZW5kKHsgbWVzc2FnZTogJ0Vycm9yIGVuIGxhIHBldGljacOzbi4nIH0pO1xyXG5cclxuICAgICAgICBpZiAoIWZvbGxvd3MpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCh7IG1lc3NhZ2U6ICdObyBoYXkgZm9sbG93cy4nIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoeyBmb2xsb3dzIH0pXHJcbiAgICB9KVxyXG59XHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cclxuICAgIGZvbGxvd1NhdmUsXHJcbiAgICB1bmZvbGxvdyxcclxuICAgIGdldEZvbGxvd2luZ1VzZXJzLFxyXG4gICAgZ2V0Rm9sbG93ZWRVc2VycyxcclxuICAgIGdldE15Rm9sbG93ZWQsXHJcbiAgICBnZXRNeUZvbGxvd3NcclxuXHJcbn0iXX0=