'use strict';function cov_tdoheqyzb(){var path="C:\\Users\\jmmar\\OneDrive\\Documentos\\Documents\\INGENIERIA INFORM\xC1TICA 4\xBA\\2DO CUATRIMESTRE\\TFG\\repo\\red-social\\api\\controllers\\message.js";var hash="e84910ab81626200626da30648b91e31a4d6c8c2";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\jmmar\\OneDrive\\Documentos\\Documents\\INGENIERIA INFORM\xC1TICA 4\xBA\\2DO CUATRIMESTRE\\TFG\\repo\\red-social\\api\\controllers\\message.js",statementMap:{"0":{start:{line:3,column:25},end:{line:3,column:55}},"1":{start:{line:4,column:13},end:{line:4,column:30}},"2":{start:{line:7,column:14},end:{line:7,column:42}},"3":{start:{line:11,column:17},end:{line:11,column:25}},"4":{start:{line:13,column:4},end:{line:13,column:110}},"5":{start:{line:13,column:42},end:{line:13,column:110}},"6":{start:{line:15,column:18},end:{line:15,column:31}},"7":{start:{line:17,column:4},end:{line:17,column:35}},"8":{start:{line:18,column:4},end:{line:18,column:39}},"9":{start:{line:19,column:4},end:{line:19,column:31}},"10":{start:{line:20,column:4},end:{line:20,column:41}},"11":{start:{line:21,column:4},end:{line:21,column:27}},"12":{start:{line:23,column:4},end:{line:29,column:6}},"13":{start:{line:24,column:8},end:{line:24,column:76}},"14":{start:{line:24,column:17},end:{line:24,column:76}},"15":{start:{line:26,column:8},end:{line:26,column:96}},"16":{start:{line:26,column:28},end:{line:26,column:96}},"17":{start:{line:28,column:8},end:{line:28,column:64}},"18":{start:{line:33,column:17},end:{line:33,column:29}},"19":{start:{line:35,column:15},end:{line:35,column:16}},"20":{start:{line:36,column:4},end:{line:38,column:5}},"21":{start:{line:37,column:8},end:{line:37,column:31}},"22":{start:{line:39,column:23},end:{line:39,column:24}},"23":{start:{line:41,column:4},end:{line:50,column:6}},"24":{start:{line:42,column:8},end:{line:42,column:76}},"25":{start:{line:42,column:17},end:{line:42,column:76}},"26":{start:{line:43,column:8},end:{line:43,column:83}},"27":{start:{line:43,column:23},end:{line:43,column:83}},"28":{start:{line:45,column:8},end:{line:49,column:10}},"29":{start:{line:54,column:17},end:{line:54,column:29}},"30":{start:{line:56,column:15},end:{line:56,column:16}},"31":{start:{line:57,column:4},end:{line:59,column:5}},"32":{start:{line:58,column:8},end:{line:58,column:31}},"33":{start:{line:60,column:23},end:{line:60,column:24}},"34":{start:{line:62,column:4},end:{line:71,column:6}},"35":{start:{line:63,column:8},end:{line:63,column:76}},"36":{start:{line:63,column:17},end:{line:63,column:76}},"37":{start:{line:64,column:8},end:{line:64,column:83}},"38":{start:{line:64,column:23},end:{line:64,column:83}},"39":{start:{line:66,column:8},end:{line:70,column:10}},"40":{start:{line:75,column:17},end:{line:75,column:29}},"41":{start:{line:77,column:4},end:{line:82,column:6}},"42":{start:{line:78,column:8},end:{line:78,column:76}},"43":{start:{line:78,column:17},end:{line:78,column:76}},"44":{start:{line:80,column:8},end:{line:80,column:57}},"45":{start:{line:86,column:17},end:{line:86,column:29}},"46":{start:{line:87,column:20},end:{line:87,column:33}},"47":{start:{line:90,column:4},end:{line:95,column:6}},"48":{start:{line:91,column:8},end:{line:91,column:76}},"49":{start:{line:91,column:17},end:{line:91,column:76}},"50":{start:{line:92,column:8},end:{line:92,column:89}},"51":{start:{line:92,column:29},end:{line:92,column:89}},"52":{start:{line:94,column:8},end:{line:94,column:66}},"53":{start:{line:99,column:0},end:{line:106,column:1}}},fnMap:{"0":{name:"saveMessage",decl:{start:{line:10,column:9},end:{line:10,column:20}},loc:{start:{line:10,column:31},end:{line:30,column:1}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:23,column:17},end:{line:23,column:18}},loc:{start:{line:23,column:41},end:{line:29,column:5}},line:23},"2":{name:"getRecMessages",decl:{start:{line:32,column:9},end:{line:32,column:23}},loc:{start:{line:32,column:34},end:{line:51,column:1}},line:32},"3":{name:"(anonymous_3)",decl:{start:{line:41,column:146},end:{line:41,column:147}},loc:{start:{line:41,column:172},end:{line:50,column:5}},line:41},"4":{name:"getSendMessages",decl:{start:{line:53,column:9},end:{line:53,column:24}},loc:{start:{line:53,column:35},end:{line:72,column:1}},line:53},"5":{name:"(anonymous_5)",decl:{start:{line:62,column:145},end:{line:62,column:146}},loc:{start:{line:62,column:171},end:{line:71,column:5}},line:62},"6":{name:"unviewedMessages",decl:{start:{line:74,column:9},end:{line:74,column:25}},loc:{start:{line:74,column:36},end:{line:83,column:1}},line:74},"7":{name:"(anonymous_7)",decl:{start:{line:77,column:71},end:{line:77,column:72}},loc:{start:{line:77,column:88},end:{line:82,column:5}},line:77},"8":{name:"setViewedMessages",decl:{start:{line:85,column:9},end:{line:85,column:26}},loc:{start:{line:85,column:37},end:{line:96,column:1}},line:85},"9":{name:"(anonymous_9)",decl:{start:{line:90,column:94},end:{line:90,column:95}},loc:{start:{line:90,column:119},end:{line:95,column:5}},line:90}},branchMap:{"0":{loc:{start:{line:13,column:4},end:{line:13,column:110}},type:"if",locations:[{start:{line:13,column:4},end:{line:13,column:110}},{start:{line:13,column:4},end:{line:13,column:110}}],line:13},"1":{loc:{start:{line:13,column:8},end:{line:13,column:40}},type:"binary-expr",locations:[{start:{line:13,column:8},end:{line:13,column:20}},{start:{line:13,column:24},end:{line:13,column:40}}],line:13},"2":{loc:{start:{line:24,column:8},end:{line:24,column:76}},type:"if",locations:[{start:{line:24,column:8},end:{line:24,column:76}},{start:{line:24,column:8},end:{line:24,column:76}}],line:24},"3":{loc:{start:{line:26,column:8},end:{line:26,column:96}},type:"if",locations:[{start:{line:26,column:8},end:{line:26,column:96}},{start:{line:26,column:8},end:{line:26,column:96}}],line:26},"4":{loc:{start:{line:36,column:4},end:{line:38,column:5}},type:"if",locations:[{start:{line:36,column:4},end:{line:38,column:5}},{start:{line:36,column:4},end:{line:38,column:5}}],line:36},"5":{loc:{start:{line:42,column:8},end:{line:42,column:76}},type:"if",locations:[{start:{line:42,column:8},end:{line:42,column:76}},{start:{line:42,column:8},end:{line:42,column:76}}],line:42},"6":{loc:{start:{line:43,column:8},end:{line:43,column:83}},type:"if",locations:[{start:{line:43,column:8},end:{line:43,column:83}},{start:{line:43,column:8},end:{line:43,column:83}}],line:43},"7":{loc:{start:{line:57,column:4},end:{line:59,column:5}},type:"if",locations:[{start:{line:57,column:4},end:{line:59,column:5}},{start:{line:57,column:4},end:{line:59,column:5}}],line:57},"8":{loc:{start:{line:63,column:8},end:{line:63,column:76}},type:"if",locations:[{start:{line:63,column:8},end:{line:63,column:76}},{start:{line:63,column:8},end:{line:63,column:76}}],line:63},"9":{loc:{start:{line:64,column:8},end:{line:64,column:83}},type:"if",locations:[{start:{line:64,column:8},end:{line:64,column:83}},{start:{line:64,column:8},end:{line:64,column:83}}],line:64},"10":{loc:{start:{line:78,column:8},end:{line:78,column:76}},type:"if",locations:[{start:{line:78,column:8},end:{line:78,column:76}},{start:{line:78,column:8},end:{line:78,column:76}}],line:78},"11":{loc:{start:{line:91,column:8},end:{line:91,column:76}},type:"if",locations:[{start:{line:91,column:8},end:{line:91,column:76}},{start:{line:91,column:8},end:{line:91,column:76}}],line:91},"12":{loc:{start:{line:92,column:8},end:{line:92,column:89}},type:"if",locations:[{start:{line:92,column:8},end:{line:92,column:89}},{start:{line:92,column:8},end:{line:92,column:89}}],line:92}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"e84910ab81626200626da30648b91e31a4d6c8c2"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_tdoheqyzb=function(){return actualCoverage;};return actualCoverage;}cov_tdoheqyzb();var mongoosePagination=(cov_tdoheqyzb().s[0]++,require('mongoose-pagination'));var moment=(cov_tdoheqyzb().s[1]++,require('moment'));var Message=(cov_tdoheqyzb().s[2]++,require('../models/message'));function saveMessage(req,res){cov_tdoheqyzb().f[0]++;var params=(cov_tdoheqyzb().s[3]++,req.body);cov_tdoheqyzb().s[4]++;if((cov_tdoheqyzb().b[1][0]++,!params.text)||(cov_tdoheqyzb().b[1][1]++,!params.receiver)){cov_tdoheqyzb().b[0][0]++;cov_tdoheqyzb().s[5]++;return res.status(200).send({message:"Enviar datos necesarios."});}else{cov_tdoheqyzb().b[0][1]++;}var message=(cov_tdoheqyzb().s[6]++,new Message());cov_tdoheqyzb().s[7]++;message.emitter=req.user.sub;cov_tdoheqyzb().s[8]++;message.receiver=params.receiver;cov_tdoheqyzb().s[9]++;message.text=params.text;cov_tdoheqyzb().s[10]++;message.created_at=moment().unix();cov_tdoheqyzb().s[11]++;message.viewed=false;cov_tdoheqyzb().s[12]++;message.save((err,messageStored)=>{cov_tdoheqyzb().f[1]++;cov_tdoheqyzb().s[13]++;if(err){cov_tdoheqyzb().b[2][0]++;cov_tdoheqyzb().s[14]++;return res.status(500).send({message:"Error petición."});}else{cov_tdoheqyzb().b[2][1]++;}cov_tdoheqyzb().s[15]++;if(!messageStored){cov_tdoheqyzb().b[3][0]++;cov_tdoheqyzb().s[16]++;return res.status(404).send({message:"Error al enviar mensaje."});}else{cov_tdoheqyzb().b[3][1]++;}cov_tdoheqyzb().s[17]++;return res.status(200).send({message:messageStored});});}function getRecMessages(req,res){cov_tdoheqyzb().f[2]++;var userId=(cov_tdoheqyzb().s[18]++,req.user.sub);var page=(cov_tdoheqyzb().s[19]++,1);cov_tdoheqyzb().s[20]++;if(req.params.page){cov_tdoheqyzb().b[4][0]++;cov_tdoheqyzb().s[21]++;page=req.params.page;}else{cov_tdoheqyzb().b[4][1]++;}var itemsPerPage=(cov_tdoheqyzb().s[22]++,5);cov_tdoheqyzb().s[23]++;Message.find({receiver:userId}).sort('-created_at').populate('emitter receiver','username email avatar _id').paginate(page,itemsPerPage,(err,messages,total)=>{cov_tdoheqyzb().f[3]++;cov_tdoheqyzb().s[24]++;if(err){cov_tdoheqyzb().b[5][0]++;cov_tdoheqyzb().s[25]++;return res.status(500).send({message:"Error petición."});}else{cov_tdoheqyzb().b[5][1]++;}cov_tdoheqyzb().s[26]++;if(!messages){cov_tdoheqyzb().b[6][0]++;cov_tdoheqyzb().s[27]++;return res.status(404).send({message:"No hay mensajes."});}else{cov_tdoheqyzb().b[6][1]++;}cov_tdoheqyzb().s[28]++;return res.status(200).send({messages:messages,total:total,pages:Math.ceil(total/itemsPerPage)});});}function getSendMessages(req,res){cov_tdoheqyzb().f[4]++;var userId=(cov_tdoheqyzb().s[29]++,req.user.sub);var page=(cov_tdoheqyzb().s[30]++,1);cov_tdoheqyzb().s[31]++;if(req.params.page){cov_tdoheqyzb().b[7][0]++;cov_tdoheqyzb().s[32]++;page=req.params.page;}else{cov_tdoheqyzb().b[7][1]++;}var itemsPerPage=(cov_tdoheqyzb().s[33]++,5);cov_tdoheqyzb().s[34]++;Message.find({emitter:userId}).sort('-created_at').populate('receiver emitter','username email avatar _id').paginate(page,itemsPerPage,(err,messages,total)=>{cov_tdoheqyzb().f[5]++;cov_tdoheqyzb().s[35]++;if(err){cov_tdoheqyzb().b[8][0]++;cov_tdoheqyzb().s[36]++;return res.status(500).send({message:"Error petición."});}else{cov_tdoheqyzb().b[8][1]++;}cov_tdoheqyzb().s[37]++;if(!messages){cov_tdoheqyzb().b[9][0]++;cov_tdoheqyzb().s[38]++;return res.status(404).send({message:"No hay mensajes."});}else{cov_tdoheqyzb().b[9][1]++;}cov_tdoheqyzb().s[39]++;return res.status(200).send({messages:messages,total:total,pages:Math.ceil(total/itemsPerPage)});});}function unviewedMessages(req,res){cov_tdoheqyzb().f[6]++;var userId=(cov_tdoheqyzb().s[40]++,req.user.sub);cov_tdoheqyzb().s[41]++;Message.countDocuments({receiver:userId,viewed:'false'}).exec((err,counts)=>{cov_tdoheqyzb().f[7]++;cov_tdoheqyzb().s[42]++;if(err){cov_tdoheqyzb().b[10][0]++;cov_tdoheqyzb().s[43]++;return res.status(500).send({message:"Error petición."});}else{cov_tdoheqyzb().b[10][1]++;}cov_tdoheqyzb().s[44]++;return res.status(200).send({unviewed:counts});});}function setViewedMessages(req,res){cov_tdoheqyzb().f[8]++;var userId=(cov_tdoheqyzb().s[45]++,req.user.sub);var messageId=(cov_tdoheqyzb().s[46]++,req.params.id);cov_tdoheqyzb().s[47]++;Message.update({receiver:userId,viewed:'false',_id:messageId},{viewed:'true'},(err,messageUpdated)=>{cov_tdoheqyzb().f[9]++;cov_tdoheqyzb().s[48]++;if(err){cov_tdoheqyzb().b[11][0]++;cov_tdoheqyzb().s[49]++;return res.status(500).send({message:"Error petición."});}else{cov_tdoheqyzb().b[11][1]++;}cov_tdoheqyzb().s[50]++;if(!messageUpdated){cov_tdoheqyzb().b[12][0]++;cov_tdoheqyzb().s[51]++;return res.status(404).send({message:"No hay mensajes."});}else{cov_tdoheqyzb().b[12][1]++;}cov_tdoheqyzb().s[52]++;return res.status(200).send({messages:messageUpdated});});}cov_tdoheqyzb().s[53]++;module.exports={saveMessage,getRecMessages,getSendMessages,unviewedMessages,setViewedMessages};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lc3NhZ2UuanMiXSwibmFtZXMiOlsibW9uZ29vc2VQYWdpbmF0aW9uIiwicmVxdWlyZSIsIm1vbWVudCIsIk1lc3NhZ2UiLCJzYXZlTWVzc2FnZSIsInJlcSIsInJlcyIsInBhcmFtcyIsImJvZHkiLCJ0ZXh0IiwicmVjZWl2ZXIiLCJzdGF0dXMiLCJzZW5kIiwibWVzc2FnZSIsImVtaXR0ZXIiLCJ1c2VyIiwic3ViIiwiY3JlYXRlZF9hdCIsInVuaXgiLCJ2aWV3ZWQiLCJzYXZlIiwiZXJyIiwibWVzc2FnZVN0b3JlZCIsImdldFJlY01lc3NhZ2VzIiwidXNlcklkIiwicGFnZSIsIml0ZW1zUGVyUGFnZSIsImZpbmQiLCJzb3J0IiwicG9wdWxhdGUiLCJwYWdpbmF0ZSIsIm1lc3NhZ2VzIiwidG90YWwiLCJwYWdlcyIsIk1hdGgiLCJjZWlsIiwiZ2V0U2VuZE1lc3NhZ2VzIiwidW52aWV3ZWRNZXNzYWdlcyIsImNvdW50RG9jdW1lbnRzIiwiZXhlYyIsImNvdW50cyIsInVudmlld2VkIiwic2V0Vmlld2VkTWVzc2FnZXMiLCJtZXNzYWdlSWQiLCJpZCIsInVwZGF0ZSIsIl9pZCIsIm1lc3NhZ2VVcGRhdGVkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsYSxxeFFBRUEsR0FBSUEsQ0FBQUEsa0JBQWtCLHlCQUFHQyxPQUFPLENBQUMscUJBQUQsQ0FBVixDQUF0QixDQUNBLEdBQUlDLENBQUFBLE1BQU0seUJBQUdELE9BQU8sQ0FBQyxRQUFELENBQVYsQ0FBVixDQUdBLEdBQUlFLENBQUFBLE9BQU8seUJBQUdGLE9BQU8sQ0FBQyxtQkFBRCxDQUFWLENBQVgsQ0FHQSxRQUFTRyxDQUFBQSxXQUFULENBQXFCQyxHQUFyQixDQUEwQkMsR0FBMUIsQ0FBK0Isd0JBQzNCLEdBQUlDLENBQUFBLE1BQU0seUJBQUdGLEdBQUcsQ0FBQ0csSUFBUCxDQUFWLENBRDJCLHVCQUczQixHQUFJLDRCQUFDRCxNQUFNLENBQUNFLElBQVIsOEJBQWdC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ZCxDQUFiLENBRmlDLHdCQUtqQ3pDLE9BQU8sQ0FBQzBDLE1BQVIsQ0FBZSxDQUFFbkMsUUFBUSxDQUFFYyxNQUFaLENBQW9CTCxNQUFNLENBQUUsT0FBNUIsQ0FBcUMyQixHQUFHLENBQUVILFNBQTFDLENBQWYsQ0FBc0UsQ0FBRXhCLE1BQU0sQ0FBRSxNQUFWLENBQXRFLENBQTBGLENBQUNFLEdBQUQsQ0FBTTBCLGNBQU4sR0FBeUIsZ0RBQy9HLEdBQUkxQixHQUFKLENBQVMsMERBQU9mLENBQUFBLEdBQUcsQ0FBQ0ssTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLENBQUVDLE9BQU8sQ0FBRSxpQkFBWCxDQUFyQixDQUFQLENBQTJELENBQXBFLGlDQUQrRyx3QkFFL0csR0FBSSxDQUFDa0MsY0FBTCxDQUFxQiwwREFBT3pDLENBQUFBLEdBQUcsQ0FBQ0ssTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLENBQUVDLE9BQU8sQ0FBRSxrQkFBWCxDQUFyQixDQUFQLENBQTRELENBQWpGLGlDQUYrRyx3QkFJL0csTUFBT1AsQ0FBQUEsR0FBRyxDQUFDSyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsQ0FBRW1CLFFBQVEsQ0FBRWdCLGNBQVosQ0FBckIsQ0FBUCxDQUNILENBTEQsRUFNSCxDLHdCQUdEQyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FDYjdDLFdBRGEsQ0FFYm1CLGNBRmEsQ0FHYmEsZUFIYSxDQUliQyxnQkFKYSxDQUtiSyxpQkFMYSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xyXG5cclxudmFyIG1vbmdvb3NlUGFnaW5hdGlvbiA9IHJlcXVpcmUoJ21vbmdvb3NlLXBhZ2luYXRpb24nKTtcclxudmFyIG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xyXG5cclxuXHJcbnZhciBNZXNzYWdlID0gcmVxdWlyZSgnLi4vbW9kZWxzL21lc3NhZ2UnKTtcclxuXHJcblxyXG5mdW5jdGlvbiBzYXZlTWVzc2FnZShyZXEsIHJlcykge1xyXG4gICAgdmFyIHBhcmFtcyA9IHJlcS5ib2R5O1xyXG5cclxuICAgIGlmICghcGFyYW1zLnRleHQgfHwgIXBhcmFtcy5yZWNlaXZlcikgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHsgbWVzc2FnZTogXCJFbnZpYXIgZGF0b3MgbmVjZXNhcmlvcy5cIiB9KVxyXG5cclxuICAgIHZhciBtZXNzYWdlID0gbmV3IE1lc3NhZ2UoKTtcclxuXHJcbiAgICBtZXNzYWdlLmVtaXR0ZXIgPSByZXEudXNlci5zdWI7XHJcbiAgICBtZXNzYWdlLnJlY2VpdmVyID0gcGFyYW1zLnJlY2VpdmVyO1xyXG4gICAgbWVzc2FnZS50ZXh0ID0gcGFyYW1zLnRleHQ7XHJcbiAgICBtZXNzYWdlLmNyZWF0ZWRfYXQgPSBtb21lbnQoKS51bml4KCk7XHJcbiAgICBtZXNzYWdlLnZpZXdlZCA9IGZhbHNlO1xyXG5cclxuICAgIG1lc3NhZ2Uuc2F2ZSgoZXJyLCBtZXNzYWdlU3RvcmVkKSA9PiB7XHJcbiAgICAgICAgaWYgKGVycikgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5zZW5kKHsgbWVzc2FnZTogXCJFcnJvciBwZXRpY2nDs24uXCIgfSlcclxuXHJcbiAgICAgICAgaWYgKCFtZXNzYWdlU3RvcmVkKSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLnNlbmQoeyBtZXNzYWdlOiBcIkVycm9yIGFsIGVudmlhciBtZW5zYWplLlwiIH0pXHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7IG1lc3NhZ2U6IG1lc3NhZ2VTdG9yZWQgfSk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRSZWNNZXNzYWdlcyhyZXEsIHJlcykge1xyXG4gICAgdmFyIHVzZXJJZCA9IHJlcS51c2VyLnN1YjtcclxuXHJcbiAgICB2YXIgcGFnZSA9IDE7XHJcbiAgICBpZiAocmVxLnBhcmFtcy5wYWdlKSB7XHJcbiAgICAgICAgcGFnZSA9IHJlcS5wYXJhbXMucGFnZTtcclxuICAgIH1cclxuICAgIHZhciBpdGVtc1BlclBhZ2UgPSA1O1xyXG5cclxuICAgIE1lc3NhZ2UuZmluZCh7IHJlY2VpdmVyOiB1c2VySWQgfSkuc29ydCgnLWNyZWF0ZWRfYXQnKS5wb3B1bGF0ZSgnZW1pdHRlciByZWNlaXZlcicsICd1c2VybmFtZSBlbWFpbCBhdmF0YXIgX2lkJykucGFnaW5hdGUocGFnZSwgaXRlbXNQZXJQYWdlLCAoZXJyLCBtZXNzYWdlcywgdG90YWwpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiBcIkVycm9yIHBldGljacOzbi5cIiB9KVxyXG4gICAgICAgIGlmICghbWVzc2FnZXMpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCh7IG1lc3NhZ2U6IFwiTm8gaGF5IG1lbnNhamVzLlwiIH0pXHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7XHJcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcyxcclxuICAgICAgICAgICAgdG90YWw6IHRvdGFsLFxyXG4gICAgICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gaXRlbXNQZXJQYWdlKVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRTZW5kTWVzc2FnZXMocmVxLCByZXMpIHtcclxuICAgIHZhciB1c2VySWQgPSByZXEudXNlci5zdWI7XHJcblxyXG4gICAgdmFyIHBhZ2UgPSAxO1xyXG4gICAgaWYgKHJlcS5wYXJhbXMucGFnZSkge1xyXG4gICAgICAgIHBhZ2UgPSByZXEucGFyYW1zLnBhZ2U7XHJcbiAgICB9XHJcbiAgICB2YXIgaXRlbXNQZXJQYWdlID0gNTtcclxuXHJcbiAgICBNZXNzYWdlLmZpbmQoeyBlbWl0dGVyOiB1c2VySWQgfSkuc29ydCgnLWNyZWF0ZWRfYXQnKS5wb3B1bGF0ZSgncmVjZWl2ZXIgZW1pdHRlcicsICd1c2VybmFtZSBlbWFpbCBhdmF0YXIgX2lkJykucGFnaW5hdGUocGFnZSwgaXRlbXNQZXJQYWdlLCAoZXJyLCBtZXNzYWdlcywgdG90YWwpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiBcIkVycm9yIHBldGljacOzbi5cIiB9KVxyXG4gICAgICAgIGlmICghbWVzc2FnZXMpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCh7IG1lc3NhZ2U6IFwiTm8gaGF5IG1lbnNhamVzLlwiIH0pXHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7XHJcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcyxcclxuICAgICAgICAgICAgdG90YWw6IHRvdGFsLFxyXG4gICAgICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gaXRlbXNQZXJQYWdlKVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiB1bnZpZXdlZE1lc3NhZ2VzKHJlcSwgcmVzKSB7XHJcbiAgICB2YXIgdXNlcklkID0gcmVxLnVzZXIuc3ViO1xyXG5cclxuICAgIE1lc3NhZ2UuY291bnREb2N1bWVudHMoeyByZWNlaXZlcjogdXNlcklkLCB2aWV3ZWQ6ICdmYWxzZScgfSkuZXhlYygoZXJyLCBjb3VudHMpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiBcIkVycm9yIHBldGljacOzbi5cIiB9KVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoeyB1bnZpZXdlZDogY291bnRzIH0pXHJcblxyXG4gICAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0Vmlld2VkTWVzc2FnZXMocmVxLCByZXMpIHtcclxuICAgIHZhciB1c2VySWQgPSByZXEudXNlci5zdWI7XHJcbiAgICB2YXIgbWVzc2FnZUlkID0gcmVxLnBhcmFtcy5pZDtcclxuXHJcblxyXG4gICAgTWVzc2FnZS51cGRhdGUoeyByZWNlaXZlcjogdXNlcklkLCB2aWV3ZWQ6ICdmYWxzZScsIF9pZDogbWVzc2FnZUlkIH0sIHsgdmlld2VkOiAndHJ1ZScgfSwgKGVyciwgbWVzc2FnZVVwZGF0ZWQpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiBcIkVycm9yIHBldGljacOzbi5cIiB9KVxyXG4gICAgICAgIGlmICghbWVzc2FnZVVwZGF0ZWQpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCh7IG1lc3NhZ2U6IFwiTm8gaGF5IG1lbnNhamVzLlwiIH0pXHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7IG1lc3NhZ2VzOiBtZXNzYWdlVXBkYXRlZCB9KTtcclxuICAgIH0pXHJcbn1cclxuXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIHNhdmVNZXNzYWdlLFxyXG4gICAgZ2V0UmVjTWVzc2FnZXMsXHJcbiAgICBnZXRTZW5kTWVzc2FnZXMsXHJcbiAgICB1bnZpZXdlZE1lc3NhZ2VzLFxyXG4gICAgc2V0Vmlld2VkTWVzc2FnZXNcclxuXHJcbn0iXX0=