'use strict';function cov_1rh0ea9mu8(){var path="C:\\Users\\jmmar\\OneDrive\\Documentos\\Documents\\INGENIERIA INFORM\xC1TICA 4\xBA\\2DO CUATRIMESTRE\\TFG\\repo\\red-social\\api\\controllers\\song.js";var hash="50047b3759b1285b51506c608f5c81e38461ca49";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\jmmar\\OneDrive\\Documentos\\Documents\\INGENIERIA INFORM\xC1TICA 4\xBA\\2DO CUATRIMESTRE\\TFG\\repo\\red-social\\api\\controllers\\song.js",statementMap:{"0":{start:{line:3,column:25},end:{line:3,column:55}},"1":{start:{line:4,column:13},end:{line:4,column:30}},"2":{start:{line:5,column:9},end:{line:5,column:22}},"3":{start:{line:6,column:11},end:{line:6,column:26}},"4":{start:{line:8,column:11},end:{line:8,column:36}},"5":{start:{line:9,column:13},end:{line:9,column:40}},"6":{start:{line:10,column:18},end:{line:10,column:50}},"7":{start:{line:15,column:17},end:{line:15,column:25}},"8":{start:{line:17,column:29},end:{line:17,column:42}},"9":{start:{line:18,column:4},end:{line:22,column:5}},"10":{start:{line:20,column:8},end:{line:20,column:70}},"11":{start:{line:23,column:4},end:{line:25,column:5}},"12":{start:{line:24,column:8},end:{line:24,column:76}},"13":{start:{line:28,column:15},end:{line:28,column:25}},"14":{start:{line:30,column:4},end:{line:30,column:32}},"15":{start:{line:31,column:4},end:{line:31,column:52}},"16":{start:{line:32,column:4},end:{line:32,column:32}},"17":{start:{line:33,column:4},end:{line:33,column:32}},"18":{start:{line:34,column:4},end:{line:34,column:37}},"19":{start:{line:38,column:4},end:{line:45,column:6}},"20":{start:{line:40,column:8},end:{line:40,column:83}},"21":{start:{line:40,column:17},end:{line:40,column:83}},"22":{start:{line:42,column:8},end:{line:42,column:105}},"23":{start:{line:42,column:25},end:{line:42,column:105}},"24":{start:{line:44,column:8},end:{line:44,column:58}},"25":{start:{line:50,column:4},end:{line:58,column:7}},"26":{start:{line:51,column:8},end:{line:51,column:83}},"27":{start:{line:51,column:17},end:{line:51,column:83}},"28":{start:{line:53,column:8},end:{line:53,column:94}},"29":{start:{line:53,column:20},end:{line:53,column:94}},"30":{start:{line:56,column:8},end:{line:56,column:47}},"31":{start:{line:64,column:15},end:{line:64,column:16}},"32":{start:{line:66,column:4},end:{line:68,column:5}},"33":{start:{line:67,column:8},end:{line:67,column:31}},"34":{start:{line:70,column:23},end:{line:70,column:24}},"35":{start:{line:72,column:4},end:{line:82,column:7}},"36":{start:{line:73,column:8},end:{line:73,column:83}},"37":{start:{line:73,column:17},end:{line:73,column:83}},"38":{start:{line:75,column:8},end:{line:75,column:94}},"39":{start:{line:75,column:20},end:{line:75,column:94}},"40":{start:{line:77,column:8},end:{line:81,column:11}},"41":{start:{line:87,column:17},end:{line:87,column:30}},"42":{start:{line:89,column:4},end:{line:98,column:6}},"43":{start:{line:90,column:8},end:{line:90,column:77}},"44":{start:{line:90,column:17},end:{line:90,column:77}},"45":{start:{line:92,column:8},end:{line:92,column:85}},"46":{start:{line:92,column:19},end:{line:92,column:85}},"47":{start:{line:94,column:8},end:{line:96,column:10}},"48":{start:{line:104,column:17},end:{line:104,column:30}},"49":{start:{line:105,column:17},end:{line:105,column:25}},"50":{start:{line:106,column:29},end:{line:106,column:42}},"51":{start:{line:107,column:4},end:{line:111,column:5}},"52":{start:{line:109,column:8},end:{line:109,column:70}},"53":{start:{line:113,column:4},end:{line:115,column:5}},"54":{start:{line:114,column:8},end:{line:114,column:76}},"55":{start:{line:117,column:4},end:{line:123,column:6}},"56":{start:{line:118,column:8},end:{line:118,column:83}},"57":{start:{line:118,column:17},end:{line:118,column:83}},"58":{start:{line:120,column:8},end:{line:120,column:109}},"59":{start:{line:120,column:26},end:{line:120,column:109}},"60":{start:{line:122,column:8},end:{line:122,column:59}},"61":{start:{line:127,column:17},end:{line:127,column:30}},"62":{start:{line:129,column:29},end:{line:129,column:42}},"63":{start:{line:130,column:4},end:{line:134,column:5}},"64":{start:{line:132,column:8},end:{line:132,column:70}},"65":{start:{line:137,column:4},end:{line:144,column:6}},"66":{start:{line:138,column:8},end:{line:138,column:77}},"67":{start:{line:138,column:17},end:{line:138,column:77}},"68":{start:{line:140,column:8},end:{line:140,column:54}},"69":{start:{line:142,column:8},end:{line:142,column:71}},"70":{start:{line:148,column:16},end:{line:148,column:32}},"71":{start:{line:151,column:15},end:{line:151,column:16}},"72":{start:{line:153,column:4},end:{line:155,column:5}},"73":{start:{line:154,column:8},end:{line:154,column:31}},"74":{start:{line:157,column:23},end:{line:157,column:24}},"75":{start:{line:159,column:4},end:{line:184,column:6}},"76":{start:{line:161,column:8},end:{line:179,column:11}},"77":{start:{line:167,column:12},end:{line:167,column:87}},"78":{start:{line:167,column:21},end:{line:167,column:87}},"79":{start:{line:170,column:12},end:{line:170,column:98}},"80":{start:{line:170,column:24},end:{line:170,column:98}},"81":{start:{line:172,column:12},end:{line:176,column:15}},"82":{start:{line:188,column:16},end:{line:192,column:6}},"83":{start:{line:189,column:8},end:{line:189,column:21}},"84":{start:{line:191,column:8},end:{line:191,column:32}},"85":{start:{line:195,column:18},end:{line:195,column:20}},"86":{start:{line:197,column:4},end:{line:199,column:7}},"87":{start:{line:198,column:8},end:{line:198,column:34}},"88":{start:{line:201,column:25},end:{line:206,column:10}},"89":{start:{line:203,column:12},end:{line:203,column:28}},"90":{start:{line:205,column:12},end:{line:205,column:36}},"91":{start:{line:208,column:24},end:{line:208,column:26}},"92":{start:{line:210,column:4},end:{line:212,column:7}},"93":{start:{line:211,column:8},end:{line:211,column:36}},"94":{start:{line:215,column:4},end:{line:217,column:5}},"95":{start:{line:221,column:0},end:{line:231,column:1}}},fnMap:{"0":{name:"songSave",decl:{start:{line:14,column:9},end:{line:14,column:17}},loc:{start:{line:14,column:28},end:{line:46,column:1}},line:14},"1":{name:"(anonymous_1)",decl:{start:{line:38,column:14},end:{line:38,column:15}},loc:{start:{line:38,column:35},end:{line:45,column:5}},line:38},"2":{name:"getSongs",decl:{start:{line:48,column:9},end:{line:48,column:17}},loc:{start:{line:48,column:28},end:{line:59,column:1}},line:48},"3":{name:"(anonymous_3)",decl:{start:{line:50,column:33},end:{line:50,column:34}},loc:{start:{line:50,column:49},end:{line:58,column:5}},line:50},"4":{name:"getSongsPagination",decl:{start:{line:62,column:9},end:{line:62,column:27}},loc:{start:{line:62,column:38},end:{line:84,column:1}},line:62},"5":{name:"(anonymous_5)",decl:{start:{line:72,column:79},end:{line:72,column:80}},loc:{start:{line:72,column:102},end:{line:82,column:5}},line:72},"6":{name:"getSong",decl:{start:{line:86,column:9},end:{line:86,column:16}},loc:{start:{line:86,column:27},end:{line:99,column:1}},line:86},"7":{name:"(anonymous_7)",decl:{start:{line:89,column:26},end:{line:89,column:27}},loc:{start:{line:89,column:41},end:{line:98,column:5}},line:89},"8":{name:"updateSong",decl:{start:{line:103,column:9},end:{line:103,column:19}},loc:{start:{line:103,column:30},end:{line:124,column:1}},line:103},"9":{name:"(anonymous_9)",decl:{start:{line:117,column:58},end:{line:117,column:59}},loc:{start:{line:117,column:80},end:{line:123,column:5}},line:117},"10":{name:"deleteSong",decl:{start:{line:126,column:9},end:{line:126,column:19}},loc:{start:{line:126,column:30},end:{line:145,column:1}},line:126},"11":{name:"(anonymous_11)",decl:{start:{line:137,column:40},end:{line:137,column:41}},loc:{start:{line:137,column:47},end:{line:144,column:5}},line:137},"12":{name:"findByTituloAndArtista",decl:{start:{line:147,column:9},end:{line:147,column:31}},loc:{start:{line:147,column:42},end:{line:185,column:1}},line:147},"13":{name:"(anonymous_13)",decl:{start:{line:159,column:32},end:{line:159,column:33}},loc:{start:{line:159,column:43},end:{line:184,column:5}},line:159},"14":{name:"(anonymous_14)",decl:{start:{line:166,column:74},end:{line:166,column:75}},loc:{start:{line:166,column:97},end:{line:179,column:9}},line:166},"15":{name:"getArtistsSongs",decl:{start:{line:187,column:15},end:{line:187,column:30}},loc:{start:{line:187,column:38},end:{line:218,column:1}},line:187},"16":{name:"(anonymous_16)",decl:{start:{line:188,column:46},end:{line:188,column:47}},loc:{start:{line:188,column:57},end:{line:190,column:5}},line:188},"17":{name:"(anonymous_17)",decl:{start:{line:190,column:13},end:{line:190,column:14}},loc:{start:{line:190,column:22},end:{line:192,column:5}},line:190},"18":{name:"(anonymous_18)",decl:{start:{line:197,column:18},end:{line:197,column:19}},loc:{start:{line:197,column:28},end:{line:199,column:5}},line:197},"19":{name:"(anonymous_19)",decl:{start:{line:202,column:14},end:{line:202,column:15}},loc:{start:{line:202,column:28},end:{line:204,column:9}},line:202},"20":{name:"(anonymous_20)",decl:{start:{line:204,column:17},end:{line:204,column:18}},loc:{start:{line:204,column:26},end:{line:206,column:9}},line:204},"21":{name:"(anonymous_21)",decl:{start:{line:210,column:27},end:{line:210,column:28}},loc:{start:{line:210,column:36},end:{line:212,column:5}},line:210}},branchMap:{"0":{loc:{start:{line:18,column:4},end:{line:22,column:5}},type:"if",locations:[{start:{line:18,column:4},end:{line:22,column:5}},{start:{line:18,column:4},end:{line:22,column:5}}],line:18},"1":{loc:{start:{line:23,column:4},end:{line:25,column:5}},type:"if",locations:[{start:{line:23,column:4},end:{line:25,column:5}},{start:{line:23,column:4},end:{line:25,column:5}}],line:23},"2":{loc:{start:{line:23,column:8},end:{line:23,column:101}},type:"binary-expr",locations:[{start:{line:23,column:8},end:{line:23,column:22}},{start:{line:23,column:26},end:{line:23,column:50}},{start:{line:23,column:54},end:{line:23,column:68}},{start:{line:23,column:72},end:{line:23,column:86}},{start:{line:23,column:90},end:{line:23,column:101}}],line:23},"3":{loc:{start:{line:40,column:8},end:{line:40,column:83}},type:"if",locations:[{start:{line:40,column:8},end:{line:40,column:83}},{start:{line:40,column:8},end:{line:40,column:83}}],line:40},"4":{loc:{start:{line:42,column:8},end:{line:42,column:105}},type:"if",locations:[{start:{line:42,column:8},end:{line:42,column:105}},{start:{line:42,column:8},end:{line:42,column:105}}],line:42},"5":{loc:{start:{line:51,column:8},end:{line:51,column:83}},type:"if",locations:[{start:{line:51,column:8},end:{line:51,column:83}},{start:{line:51,column:8},end:{line:51,column:83}}],line:51},"6":{loc:{start:{line:53,column:8},end:{line:53,column:94}},type:"if",locations:[{start:{line:53,column:8},end:{line:53,column:94}},{start:{line:53,column:8},end:{line:53,column:94}}],line:53},"7":{loc:{start:{line:66,column:4},end:{line:68,column:5}},type:"if",locations:[{start:{line:66,column:4},end:{line:68,column:5}},{start:{line:66,column:4},end:{line:68,column:5}}],line:66},"8":{loc:{start:{line:73,column:8},end:{line:73,column:83}},type:"if",locations:[{start:{line:73,column:8},end:{line:73,column:83}},{start:{line:73,column:8},end:{line:73,column:83}}],line:73},"9":{loc:{start:{line:75,column:8},end:{line:75,column:94}},type:"if",locations:[{start:{line:75,column:8},end:{line:75,column:94}},{start:{line:75,column:8},end:{line:75,column:94}}],line:75},"10":{loc:{start:{line:90,column:8},end:{line:90,column:77}},type:"if",locations:[{start:{line:90,column:8},end:{line:90,column:77}},{start:{line:90,column:8},end:{line:90,column:77}}],line:90},"11":{loc:{start:{line:92,column:8},end:{line:92,column:85}},type:"if",locations:[{start:{line:92,column:8},end:{line:92,column:85}},{start:{line:92,column:8},end:{line:92,column:85}}],line:92},"12":{loc:{start:{line:107,column:4},end:{line:111,column:5}},type:"if",locations:[{start:{line:107,column:4},end:{line:111,column:5}},{start:{line:107,column:4},end:{line:111,column:5}}],line:107},"13":{loc:{start:{line:113,column:4},end:{line:115,column:5}},type:"if",locations:[{start:{line:113,column:4},end:{line:115,column:5}},{start:{line:113,column:4},end:{line:115,column:5}}],line:113},"14":{loc:{start:{line:113,column:8},end:{line:113,column:101}},type:"binary-expr",locations:[{start:{line:113,column:8},end:{line:113,column:22}},{start:{line:113,column:26},end:{line:113,column:50}},{start:{line:113,column:54},end:{line:113,column:68}},{start:{line:113,column:72},end:{line:113,column:86}},{start:{line:113,column:90},end:{line:113,column:101}}],line:113},"15":{loc:{start:{line:118,column:8},end:{line:118,column:83}},type:"if",locations:[{start:{line:118,column:8},end:{line:118,column:83}},{start:{line:118,column:8},end:{line:118,column:83}}],line:118},"16":{loc:{start:{line:120,column:8},end:{line:120,column:109}},type:"if",locations:[{start:{line:120,column:8},end:{line:120,column:109}},{start:{line:120,column:8},end:{line:120,column:109}}],line:120},"17":{loc:{start:{line:130,column:4},end:{line:134,column:5}},type:"if",locations:[{start:{line:130,column:4},end:{line:134,column:5}},{start:{line:130,column:4},end:{line:134,column:5}}],line:130},"18":{loc:{start:{line:138,column:8},end:{line:138,column:77}},type:"if",locations:[{start:{line:138,column:8},end:{line:138,column:77}},{start:{line:138,column:8},end:{line:138,column:77}}],line:138},"19":{loc:{start:{line:153,column:4},end:{line:155,column:5}},type:"if",locations:[{start:{line:153,column:4},end:{line:155,column:5}},{start:{line:153,column:4},end:{line:155,column:5}}],line:153},"20":{loc:{start:{line:167,column:12},end:{line:167,column:87}},type:"if",locations:[{start:{line:167,column:12},end:{line:167,column:87}},{start:{line:167,column:12},end:{line:167,column:87}}],line:167},"21":{loc:{start:{line:170,column:12},end:{line:170,column:98}},type:"if",locations:[{start:{line:170,column:12},end:{line:170,column:98}},{start:{line:170,column:12},end:{line:170,column:98}}],line:170}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},b:{"0":[0,0],"1":[0,0],"2":[0,0,0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0,0,0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"50047b3759b1285b51506c608f5c81e38461ca49"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1rh0ea9mu8=function(){return actualCoverage;};return actualCoverage;}cov_1rh0ea9mu8();var mongoosePagination=(cov_1rh0ea9mu8().s[0]++,require('mongoose-pagination'));var moment=(cov_1rh0ea9mu8().s[1]++,require('moment'));var fs=(cov_1rh0ea9mu8().s[2]++,require('fs'));var path=(cov_1rh0ea9mu8().s[3]++,require('path'));var Song=(cov_1rh0ea9mu8().s[4]++,require('../models/song'));var Artist=(cov_1rh0ea9mu8().s[5]++,require('../models/artist'));var Publication=(cov_1rh0ea9mu8().s[6]++,require('../models/publication'));function songSave(req,res){cov_1rh0ea9mu8().f[0]++;var params=(cov_1rh0ea9mu8().s[7]++,req.body);var identity_user_role=(cov_1rh0ea9mu8().s[8]++,req.user.role);cov_1rh0ea9mu8().s[9]++;if(identity_user_role!='ROLE_ADMIN'){cov_1rh0ea9mu8().b[0][0]++;cov_1rh0ea9mu8().s[10]++;return res.status(403).send({message:'No tienes acceso.'});}else{cov_1rh0ea9mu8().b[0][1]++;}cov_1rh0ea9mu8().s[11]++;if((cov_1rh0ea9mu8().b[2][0]++,!params.titulo)||(cov_1rh0ea9mu8().b[2][1]++,!params.fechaLanzamiento)||(cov_1rh0ea9mu8().b[2][2]++,!params.imagen)||(cov_1rh0ea9mu8().b[2][3]++,!params.artist)||(cov_1rh0ea9mu8().b[2][4]++,!params.url)){cov_1rh0ea9mu8().b[1][0]++;cov_1rh0ea9mu8().s[12]++;return res.status(200).send({message:"Enviar datos necesarios."});}else{cov_1rh0ea9mu8().b[1][1]++;}var song=(cov_1rh0ea9mu8().s[13]++,new Song());cov_1rh0ea9mu8().s[14]++;song.titulo=params.titulo;cov_1rh0ea9mu8().s[15]++;song.fechaLanzamiento=params.fechaLanzamiento;cov_1rh0ea9mu8().s[16]++;song.imagen=params.imagen;cov_1rh0ea9mu8().s[17]++;song.artist=params.artist;cov_1rh0ea9mu8().s[18]++;song.url=params.url.substr(14);cov_1rh0ea9mu8().s[19]++;song.save((err,songStored)=>{cov_1rh0ea9mu8().f[1]++;cov_1rh0ea9mu8().s[20]++;if(err){cov_1rh0ea9mu8().b[3][0]++;cov_1rh0ea9mu8().s[21]++;return res.status(500).send({message:'Error en la petición.'});}else{cov_1rh0ea9mu8().b[3][1]++;}cov_1rh0ea9mu8().s[22]++;if(!songStored){cov_1rh0ea9mu8().b[4][0]++;cov_1rh0ea9mu8().s[23]++;return res.status(404).send({message:'No se ha podido guardar la canción.'});}else{cov_1rh0ea9mu8().b[4][1]++;}cov_1rh0ea9mu8().s[24]++;return res.status(200).send({song:songStored});});}function getSongs(req,res){cov_1rh0ea9mu8().f[2]++;cov_1rh0ea9mu8().s[25]++;Song.find().sort('_id').exec((err,songs)=>{cov_1rh0ea9mu8().f[3]++;cov_1rh0ea9mu8().s[26]++;if(err){cov_1rh0ea9mu8().b[5][0]++;cov_1rh0ea9mu8().s[27]++;return res.status(500).send({message:'Error en la petición.'});}else{cov_1rh0ea9mu8().b[5][1]++;}cov_1rh0ea9mu8().s[28]++;if(!songs){cov_1rh0ea9mu8().b[6][0]++;cov_1rh0ea9mu8().s[29]++;return res.status(404).send({message:'No hay canciones disponibles.'});}else{cov_1rh0ea9mu8().b[6][1]++;}cov_1rh0ea9mu8().s[30]++;return res.status(200).send({songs});});}// paginados
function getSongsPagination(req,res){cov_1rh0ea9mu8().f[4]++;var page=(cov_1rh0ea9mu8().s[31]++,1);cov_1rh0ea9mu8().s[32]++;if(req.params.page){cov_1rh0ea9mu8().b[7][0]++;cov_1rh0ea9mu8().s[33]++;page=req.params.page;}else{cov_1rh0ea9mu8().b[7][1]++;}var itemsPerPage=(cov_1rh0ea9mu8().s[34]++,5);cov_1rh0ea9mu8().s[35]++;Song.find().sort('titulo').populate('artist').paginate(page,itemsPerPage,(err,songs,total)=>{cov_1rh0ea9mu8().f[5]++;cov_1rh0ea9mu8().s[36]++;if(err){cov_1rh0ea9mu8().b[8][0]++;cov_1rh0ea9mu8().s[37]++;return res.status(500).send({message:'Error en la petición.'});}else{cov_1rh0ea9mu8().b[8][1]++;}cov_1rh0ea9mu8().s[38]++;if(!songs){cov_1rh0ea9mu8().b[9][0]++;cov_1rh0ea9mu8().s[39]++;return res.status(404).send({message:'No hay canciones disponibles.'});}else{cov_1rh0ea9mu8().b[9][1]++;}cov_1rh0ea9mu8().s[40]++;return res.status(200).send({songs,total,pages:Math.ceil(total/itemsPerPage)});});}function getSong(req,res){cov_1rh0ea9mu8().f[6]++;var songId=(cov_1rh0ea9mu8().s[41]++,req.params.id);cov_1rh0ea9mu8().s[42]++;Song.findById(songId,(err,song)=>{cov_1rh0ea9mu8().f[7]++;cov_1rh0ea9mu8().s[43]++;if(err){cov_1rh0ea9mu8().b[10][0]++;cov_1rh0ea9mu8().s[44]++;return res.status(500).send({message:'Error petición.'});}else{cov_1rh0ea9mu8().b[10][1]++;}cov_1rh0ea9mu8().s[45]++;if(!song){cov_1rh0ea9mu8().b[11][0]++;cov_1rh0ea9mu8().s[46]++;return res.status(404).send({message:'La canción no existe.'});}else{cov_1rh0ea9mu8().b[11][1]++;}cov_1rh0ea9mu8().s[47]++;return res.status(200).send({song:song});});}//Editar canción
function updateSong(req,res){cov_1rh0ea9mu8().f[8]++;var songId=(cov_1rh0ea9mu8().s[48]++,req.params.id);var update=(cov_1rh0ea9mu8().s[49]++,req.body);var identity_user_role=(cov_1rh0ea9mu8().s[50]++,req.user.role);cov_1rh0ea9mu8().s[51]++;if(identity_user_role!='ROLE_ADMIN'){cov_1rh0ea9mu8().b[12][0]++;cov_1rh0ea9mu8().s[52]++;return res.status(403).send({message:'No tienes acceso.'});}else{cov_1rh0ea9mu8().b[12][1]++;}cov_1rh0ea9mu8().s[53]++;if((cov_1rh0ea9mu8().b[14][0]++,!update.titulo)||(cov_1rh0ea9mu8().b[14][1]++,!update.fechaLanzamiento)||(cov_1rh0ea9mu8().b[14][2]++,!update.imagen)||(cov_1rh0ea9mu8().b[14][3]++,!update.artist)||(cov_1rh0ea9mu8().b[14][4]++,!update.url)){cov_1rh0ea9mu8().b[13][0]++;cov_1rh0ea9mu8().s[54]++;return res.status(200).send({message:"Enviar datos necesarios."});}else{cov_1rh0ea9mu8().b[13][1]++;}cov_1rh0ea9mu8().s[55]++;Song.findByIdAndUpdate(songId,update,{new:true},(err,songUpdated)=>{cov_1rh0ea9mu8().f[9]++;cov_1rh0ea9mu8().s[56]++;if(err){cov_1rh0ea9mu8().b[15][0]++;cov_1rh0ea9mu8().s[57]++;return res.status(500).send({message:'Error en la petición.'});}else{cov_1rh0ea9mu8().b[15][1]++;}cov_1rh0ea9mu8().s[58]++;if(!songUpdated){cov_1rh0ea9mu8().b[16][0]++;cov_1rh0ea9mu8().s[59]++;return res.status(404).send({message:'No se ha podido actualizar la canción.'});}else{cov_1rh0ea9mu8().b[16][1]++;}cov_1rh0ea9mu8().s[60]++;return res.status(200).send({song:songUpdated});});}function deleteSong(req,res){cov_1rh0ea9mu8().f[10]++;var songId=(cov_1rh0ea9mu8().s[61]++,req.params.id);var identity_user_role=(cov_1rh0ea9mu8().s[62]++,req.user.role);cov_1rh0ea9mu8().s[63]++;if(identity_user_role!='ROLE_ADMIN'){cov_1rh0ea9mu8().b[17][0]++;cov_1rh0ea9mu8().s[64]++;return res.status(403).send({message:'No tienes acceso.'});}else{cov_1rh0ea9mu8().b[17][1]++;}cov_1rh0ea9mu8().s[65]++;Song.find({'_id':songId}).remove(err=>{cov_1rh0ea9mu8().f[11]++;cov_1rh0ea9mu8().s[66]++;if(err){cov_1rh0ea9mu8().b[18][0]++;cov_1rh0ea9mu8().s[67]++;return res.status(500).send({message:'Error petición.'});}else{cov_1rh0ea9mu8().b[18][1]++;}//if (!publicationRemoved) return res.status(404).send({ message: 'La publicación no se ha eliminado.' });
cov_1rh0ea9mu8().s[68]++;Publication.remove({"song":songId}).exec();cov_1rh0ea9mu8().s[69]++;return res.status(200).send({message:'Canción eliminada.'});});}function findByTituloAndArtista(req,res){cov_1rh0ea9mu8().f[12]++;var query=(cov_1rh0ea9mu8().s[70]++,req.params.query);var page=(cov_1rh0ea9mu8().s[71]++,1);cov_1rh0ea9mu8().s[72]++;if(req.params.page){cov_1rh0ea9mu8().b[19][0]++;cov_1rh0ea9mu8().s[73]++;page=req.params.page;}else{cov_1rh0ea9mu8().b[19][1]++;}var itemsPerPage=(cov_1rh0ea9mu8().s[74]++,5);cov_1rh0ea9mu8().s[75]++;getArtistsSongs(query).then(value=>{cov_1rh0ea9mu8().f[13]++;cov_1rh0ea9mu8().s[76]++;Song.find({$or:[{"titulo":{$regex:query,$options:'i'}},{"artist":{"$in":value.artists}}]}).populate('artist').sort('titulo').paginate(page,itemsPerPage,(err,songs,total)=>{cov_1rh0ea9mu8().f[14]++;cov_1rh0ea9mu8().s[77]++;if(err){cov_1rh0ea9mu8().b[20][0]++;cov_1rh0ea9mu8().s[78]++;return res.status(500).send({message:'Error en la petición.'});}else{cov_1rh0ea9mu8().b[20][1]++;}cov_1rh0ea9mu8().s[79]++;if(!songs){cov_1rh0ea9mu8().b[21][0]++;cov_1rh0ea9mu8().s[80]++;return res.status(404).send({message:'No hay canciones disponibles.'});}else{cov_1rh0ea9mu8().b[21][1]++;}cov_1rh0ea9mu8().s[81]++;return res.status(200).send({songs,total,pages:Math.ceil(total/itemsPerPage)});});});}async function getArtistsSongs(query){cov_1rh0ea9mu8().f[15]++;var songs=(cov_1rh0ea9mu8().s[82]++,await Song.find().exec().then(songs=>{cov_1rh0ea9mu8().f[16]++;cov_1rh0ea9mu8().s[83]++;return songs;}).catch(err=>{cov_1rh0ea9mu8().f[17]++;cov_1rh0ea9mu8().s[84]++;return handleError(err);}));//Procesando artists que tienen cancion
var artists=(cov_1rh0ea9mu8().s[85]++,[]);cov_1rh0ea9mu8().s[86]++;songs.forEach(song=>{cov_1rh0ea9mu8().f[18]++;cov_1rh0ea9mu8().s[87]++;artists.push(song.artist);});var artistWithSong=(cov_1rh0ea9mu8().s[88]++,await Artist.find({$and:[{"_id":{"$in":artists}},{"nombre":{$regex:query,$options:'i'}}]}).exec().then(artistsN=>{cov_1rh0ea9mu8().f[19]++;cov_1rh0ea9mu8().s[89]++;return artistsN;}).catch(err=>{cov_1rh0ea9mu8().f[20]++;cov_1rh0ea9mu8().s[90]++;return handleError(err);}));var artists_clean=(cov_1rh0ea9mu8().s[91]++,[]);cov_1rh0ea9mu8().s[92]++;artistWithSong.forEach(art=>{cov_1rh0ea9mu8().f[21]++;cov_1rh0ea9mu8().s[93]++;artists_clean.push(art._id);});cov_1rh0ea9mu8().s[94]++;return{artists:artists_clean};}cov_1rh0ea9mu8().s[95]++;module.exports={songSave,getSongs,getSongsPagination,getSong,updateSong,deleteSong,findByTituloAndArtista};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNvbmcuanMiXSwibmFtZXMiOlsibW9uZ29vc2VQYWdpbmF0aW9uIiwicmVxdWlyZSIsIm1vbWVudCIsImZzIiwicGF0aCIsIlNvbmciLCJBcnRpc3QiLCJQdWJsaWNhdGlvbiIsInNvbmdTYXZlIiwicmVxIiwicmVzIiwicGFyYW1zIiwiYm9keSIsImlkZW50aXR5X3VzZXJfcm9sZSIsInVzZXIiLCJyb2xlIiwic3RhdHVzIiwic2VuZCIsIm1lc3NhZ2UiLCJ0aXR1bG8iLCJmZWNoYUxhbnphbWllbnRvIiwiaW1hZ2VuIiwiYXJ0aXN0IiwidXJsIiwic29uZyIsInN1YnN0ciIsInNhdmUiLCJlcnIiLCJzb25nU3RvcmVkIiwiZ2V0U29uZ3MiLCJmaW5kIiwic29ydCIsImV4ZWMiLCJzb25ncyIsImdldFNvbmdzUGFnaW5hdGlvbiIsInBhZ2UiLCJpdGVtc1BlclBhZ2UiLCJwb3B1bGF0ZSIsInBhZ2luYXRlIiwidG90YWwiLCJwYWdlcyIsIk1hdGgiLCJjZWlsIiwiZ2V0U29uZyIsInNvbmdJZCIsImlkIiwiZmluZEJ5SWQiLCJ1cGRhdGVTb25nIiwidXBkYXRlIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJuZXciLCJzb25nVXBkYXRlZCIsImRlbGV0ZVNvbmciLCJyZW1vdmUiLCJmaW5kQnlUaXR1bG9BbmRBcnRpc3RhIiwicXVlcnkiLCJnZXRBcnRpc3RzU29uZ3MiLCJ0aGVuIiwidmFsdWUiLCIkb3IiLCIkcmVnZXgiLCIkb3B0aW9ucyIsImFydGlzdHMiLCJjYXRjaCIsImhhbmRsZUVycm9yIiwiZm9yRWFjaCIsInB1c2giLCJhcnRpc3RXaXRoU29uZyIsIiRhbmQiLCJhcnRpc3RzTiIsImFydGlzdHNfY2xlYW4iLCJhcnQiLCJfaWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxhLG9oZUFFQSxHQUFJQSxDQUFBQSxrQkFBa0IsMEJBQUdDLE9BQU8sQ0FBQyxxQkFBRCxDQUFWLENBQXRCLENBQ0EsR0FBSUMsQ0FBQUEsTUFBTSww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QWExQyxJQUFJLENBQUNGLE1BQWxCLEVBQ0gsQ0FGRCxFQUlBLEdBQUk2QyxDQUFBQSxjQUFjLDJCQUFHLEtBQU03RCxDQUFBQSxNQUFNLENBQUN3QixJQUFQLENBQVksQ0FBRXNDLElBQUksQ0FBRSxDQUFDLENBQUUsTUFBTyxDQUFFLE1BQU9OLE9BQVQsQ0FBVCxDQUFELENBQWdDLENBQUUsU0FBVSxDQUFFRixNQUFNLENBQUVMLEtBQVYsQ0FBaUJNLFFBQVEsQ0FBRSxHQUEzQixDQUFaLENBQWhDLENBQVIsQ0FBWixFQUF1RzdCLElBQXZHLEdBQ3RCeUIsSUFEc0IsQ0FDaEJZLFFBQUQsRUFBYyxtREFDaEIsTUFBT0EsQ0FBQUEsUUFBUCxDQUNILENBSHNCLEVBR3BCTixLQUhvQixDQUdicEMsR0FBRCxFQUFTLG1EQUNkLE1BQU9xQyxDQUFBQSxXQUFXLENBQUNyQyxHQUFELENBQWxCLENBQ0gsQ0FMc0IsQ0FBVCxDQUFsQixDQU9BLEdBQUkyQyxDQUFBQSxhQUFhLDJCQUFHLEVBQUgsQ0FBakIsQ0FyQmtDLHlCQXVCbENILGNBQWMsQ0FBQ0YsT0FBZixDQUF3Qk0sR0FBRCxFQUFTLG1EQUM1QkQsYUFBYSxDQUFDSixJQUFkLENBQW1CSyxHQUFHLENBQUNDLEdBQXZCLEVBQ0gsQ0FGRCxFQXZCa0MseUJBNEJsQyxNQUFPLENBQ0hWLE9BQU8sQ0FBRVEsYUFETixDQUFQLENBR0gsQyx5QkFHREcsTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBRWJsRSxRQUZhLENBR2JxQixRQUhhLENBSWJLLGtCQUphLENBS2JTLE9BTGEsQ0FNYkksVUFOYSxDQU9iSyxVQVBhLENBUWJFLHNCQVJhLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXHJcblxyXG52YXIgbW9uZ29vc2VQYWdpbmF0aW9uID0gcmVxdWlyZSgnbW9uZ29vc2UtcGFnaW5hdGlvbicpO1xyXG52YXIgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XHJcbnZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7XHJcbnZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5cclxudmFyIFNvbmcgPSByZXF1aXJlKCcuLi9tb2RlbHMvc29uZycpO1xyXG52YXIgQXJ0aXN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL2FydGlzdCcpO1xyXG52YXIgUHVibGljYXRpb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvcHVibGljYXRpb24nKTtcclxuXHJcblxyXG5cclxuZnVuY3Rpb24gc29uZ1NhdmUocmVxLCByZXMpIHtcclxuICAgIHZhciBwYXJhbXMgPSByZXEuYm9keTtcclxuXHJcbiAgICB2YXIgaWRlbnRpdHlfdXNlcl9yb2xlID0gcmVxLnVzZXIucm9sZTtcclxuICAgIGlmIChpZGVudGl0eV91c2VyX3JvbGUgIT0gJ1JPTEVfQURNSU4nKSB7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuc2VuZCh7IG1lc3NhZ2U6ICdObyB0aWVuZXMgYWNjZXNvLicgfSk7XHJcblxyXG4gICAgfVxyXG4gICAgaWYgKCFwYXJhbXMudGl0dWxvIHx8ICFwYXJhbXMuZmVjaGFMYW56YW1pZW50byB8fCAhcGFyYW1zLmltYWdlbiB8fCAhcGFyYW1zLmFydGlzdCB8fCAhcGFyYW1zLnVybCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7IG1lc3NhZ2U6IFwiRW52aWFyIGRhdG9zIG5lY2VzYXJpb3MuXCIgfSlcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIHNvbmcgPSBuZXcgU29uZygpO1xyXG5cclxuICAgIHNvbmcudGl0dWxvID0gcGFyYW1zLnRpdHVsbztcclxuICAgIHNvbmcuZmVjaGFMYW56YW1pZW50byA9IHBhcmFtcy5mZWNoYUxhbnphbWllbnRvO1xyXG4gICAgc29uZy5pbWFnZW4gPSBwYXJhbXMuaW1hZ2VuO1xyXG4gICAgc29uZy5hcnRpc3QgPSBwYXJhbXMuYXJ0aXN0O1xyXG4gICAgc29uZy51cmwgPSBwYXJhbXMudXJsLnN1YnN0cigxNCk7XHJcblxyXG5cclxuXHJcbiAgICBzb25nLnNhdmUoKGVyciwgc29uZ1N0b3JlZCkgPT4ge1xyXG5cclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgZW4gbGEgcGV0aWNpw7NuLicgfSk7XHJcblxyXG4gICAgICAgIGlmICghc29uZ1N0b3JlZCkgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5zZW5kKHsgbWVzc2FnZTogJ05vIHNlIGhhIHBvZGlkbyBndWFyZGFyIGxhIGNhbmNpw7NuLicgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7IHNvbmc6IHNvbmdTdG9yZWQgfSk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRTb25ncyhyZXEsIHJlcykge1xyXG5cclxuICAgIFNvbmcuZmluZCgpLnNvcnQoJ19pZCcpLmV4ZWMoKGVyciwgc29uZ3MpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgZW4gbGEgcGV0aWNpw7NuLicgfSk7XHJcblxyXG4gICAgICAgIGlmICghc29uZ3MpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCh7IG1lc3NhZ2U6ICdObyBoYXkgY2FuY2lvbmVzIGRpc3BvbmlibGVzLicgfSk7XHJcblxyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoeyBzb25ncyB9KTtcclxuXHJcbiAgICB9KTtcclxufVxyXG5cclxuLy8gcGFnaW5hZG9zXHJcbmZ1bmN0aW9uIGdldFNvbmdzUGFnaW5hdGlvbihyZXEsIHJlcykge1xyXG5cclxuICAgIHZhciBwYWdlID0gMTtcclxuXHJcbiAgICBpZiAocmVxLnBhcmFtcy5wYWdlKSB7XHJcbiAgICAgICAgcGFnZSA9IHJlcS5wYXJhbXMucGFnZTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgaXRlbXNQZXJQYWdlID0gNTtcclxuXHJcbiAgICBTb25nLmZpbmQoKS5zb3J0KCd0aXR1bG8nKS5wb3B1bGF0ZSgnYXJ0aXN0JykucGFnaW5hdGUocGFnZSwgaXRlbXNQZXJQYWdlLCAoZXJyLCBzb25ncywgdG90YWwpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgZW4gbGEgcGV0aWNpw7NuLicgfSk7XHJcblxyXG4gICAgICAgIGlmICghc29uZ3MpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCh7IG1lc3NhZ2U6ICdObyBoYXkgY2FuY2lvbmVzIGRpc3BvbmlibGVzLicgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7XHJcbiAgICAgICAgICAgIHNvbmdzLFxyXG4gICAgICAgICAgICB0b3RhbCxcclxuICAgICAgICAgICAgcGFnZXM6IE1hdGguY2VpbCh0b3RhbCAvIGl0ZW1zUGVyUGFnZSlcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0U29uZyhyZXEsIHJlcykge1xyXG4gICAgdmFyIHNvbmdJZCA9IHJlcS5wYXJhbXMuaWQ7XHJcblxyXG4gICAgU29uZy5maW5kQnlJZChzb25nSWQsIChlcnIsIHNvbmcpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgcGV0aWNpw7NuLicgfSk7XHJcblxyXG4gICAgICAgIGlmICghc29uZykgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5zZW5kKHsgbWVzc2FnZTogJ0xhIGNhbmNpw7NuIG5vIGV4aXN0ZS4nIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoe1xyXG4gICAgICAgICAgICBzb25nOiBzb25nXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICB9KVxyXG59XHJcblxyXG4vL0VkaXRhciBjYW5jacOzblxyXG5cclxuZnVuY3Rpb24gdXBkYXRlU29uZyhyZXEsIHJlcykge1xyXG4gICAgdmFyIHNvbmdJZCA9IHJlcS5wYXJhbXMuaWQ7XHJcbiAgICB2YXIgdXBkYXRlID0gcmVxLmJvZHk7XHJcbiAgICB2YXIgaWRlbnRpdHlfdXNlcl9yb2xlID0gcmVxLnVzZXIucm9sZTtcclxuICAgIGlmIChpZGVudGl0eV91c2VyX3JvbGUgIT0gJ1JPTEVfQURNSU4nKSB7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuc2VuZCh7IG1lc3NhZ2U6ICdObyB0aWVuZXMgYWNjZXNvLicgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGlmICghdXBkYXRlLnRpdHVsbyB8fCAhdXBkYXRlLmZlY2hhTGFuemFtaWVudG8gfHwgIXVwZGF0ZS5pbWFnZW4gfHwgIXVwZGF0ZS5hcnRpc3QgfHwgIXVwZGF0ZS51cmwpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoeyBtZXNzYWdlOiBcIkVudmlhciBkYXRvcyBuZWNlc2FyaW9zLlwiIH0pXHJcbiAgICB9XHJcblxyXG4gICAgU29uZy5maW5kQnlJZEFuZFVwZGF0ZShzb25nSWQsIHVwZGF0ZSwgeyBuZXc6IHRydWUgfSwgKGVyciwgc29uZ1VwZGF0ZWQpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBtZXNzYWdlOiAnRXJyb3IgZW4gbGEgcGV0aWNpw7NuLicgfSk7XHJcblxyXG4gICAgICAgIGlmICghc29uZ1VwZGF0ZWQpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCh7IG1lc3NhZ2U6ICdObyBzZSBoYSBwb2RpZG8gYWN0dWFsaXphciBsYSBjYW5jacOzbi4nIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoeyBzb25nOiBzb25nVXBkYXRlZCB9KTtcclxuICAgIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRlbGV0ZVNvbmcocmVxLCByZXMpIHtcclxuICAgIHZhciBzb25nSWQgPSByZXEucGFyYW1zLmlkO1xyXG5cclxuICAgIHZhciBpZGVudGl0eV91c2VyX3JvbGUgPSByZXEudXNlci5yb2xlO1xyXG4gICAgaWYgKGlkZW50aXR5X3VzZXJfcm9sZSAhPSAnUk9MRV9BRE1JTicpIHtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5zZW5kKHsgbWVzc2FnZTogJ05vIHRpZW5lcyBhY2Nlc28uJyB9KTtcclxuXHJcbiAgICB9XHJcblxyXG5cclxuICAgIFNvbmcuZmluZCh7ICdfaWQnOiBzb25nSWQgfSkucmVtb3ZlKGVyciA9PiB7XHJcbiAgICAgICAgaWYgKGVycikgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5zZW5kKHsgbWVzc2FnZTogJ0Vycm9yIHBldGljacOzbi4nIH0pO1xyXG4gICAgICAgIC8vaWYgKCFwdWJsaWNhdGlvblJlbW92ZWQpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCh7IG1lc3NhZ2U6ICdMYSBwdWJsaWNhY2nDs24gbm8gc2UgaGEgZWxpbWluYWRvLicgfSk7XHJcbiAgICAgICAgUHVibGljYXRpb24ucmVtb3ZlKHsgXCJzb25nXCI6IHNvbmdJZCB9KS5leGVjKCk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7IG1lc3NhZ2U6ICdDYW5jacOzbiBlbGltaW5hZGEuJyB9KTtcclxuXHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBmaW5kQnlUaXR1bG9BbmRBcnRpc3RhKHJlcSwgcmVzKSB7XHJcbiAgICB2YXIgcXVlcnkgPSByZXEucGFyYW1zLnF1ZXJ5O1xyXG5cclxuXHJcbiAgICB2YXIgcGFnZSA9IDE7XHJcblxyXG4gICAgaWYgKHJlcS5wYXJhbXMucGFnZSkge1xyXG4gICAgICAgIHBhZ2UgPSByZXEucGFyYW1zLnBhZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGl0ZW1zUGVyUGFnZSA9IDU7XHJcblxyXG4gICAgZ2V0QXJ0aXN0c1NvbmdzKHF1ZXJ5KS50aGVuKCh2YWx1ZSkgPT4ge1xyXG5cclxuICAgICAgICBTb25nLmZpbmQoe1xyXG4gICAgICAgICAgICAkb3I6IFtcclxuICAgICAgICAgICAgICAgIHsgXCJ0aXR1bG9cIjogeyAkcmVnZXg6IHF1ZXJ5LCAkb3B0aW9uczogJ2knIH0gfSxcclxuICAgICAgICAgICAgICAgIHsgXCJhcnRpc3RcIjogeyBcIiRpblwiOiB2YWx1ZS5hcnRpc3RzIH0gfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfSkucG9wdWxhdGUoJ2FydGlzdCcpLnNvcnQoJ3RpdHVsbycpLnBhZ2luYXRlKHBhZ2UsIGl0ZW1zUGVyUGFnZSwgKGVyciwgc29uZ3MsIHRvdGFsKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHJldHVybiByZXMuc3RhdHVzKDUwMCkuc2VuZCh7IG1lc3NhZ2U6ICdFcnJvciBlbiBsYSBwZXRpY2nDs24uJyB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoIXNvbmdzKSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLnNlbmQoeyBtZXNzYWdlOiAnTm8gaGF5IGNhbmNpb25lcyBkaXNwb25pYmxlcy4nIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgICAgICAgICAgIHNvbmdzLFxyXG4gICAgICAgICAgICAgICAgdG90YWwsXHJcbiAgICAgICAgICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gaXRlbXNQZXJQYWdlKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcblxyXG5cclxuICAgIH0pXHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEFydGlzdHNTb25ncyhxdWVyeSkge1xyXG4gICAgdmFyIHNvbmdzID0gYXdhaXQgU29uZy5maW5kKCkuZXhlYygpLnRoZW4oKHNvbmdzKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHNvbmdzO1xyXG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIHJldHVybiBoYW5kbGVFcnJvcihlcnIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy9Qcm9jZXNhbmRvIGFydGlzdHMgcXVlIHRpZW5lbiBjYW5jaW9uXHJcbiAgICB2YXIgYXJ0aXN0cyA9IFtdO1xyXG5cclxuICAgIHNvbmdzLmZvckVhY2goKHNvbmcpID0+IHtcclxuICAgICAgICBhcnRpc3RzLnB1c2goc29uZy5hcnRpc3QpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdmFyIGFydGlzdFdpdGhTb25nID0gYXdhaXQgQXJ0aXN0LmZpbmQoeyAkYW5kOiBbeyBcIl9pZFwiOiB7IFwiJGluXCI6IGFydGlzdHMgfSB9LCB7IFwibm9tYnJlXCI6IHsgJHJlZ2V4OiBxdWVyeSwgJG9wdGlvbnM6ICdpJyB9IH1dIH0pLmV4ZWMoKVxyXG4gICAgICAgIC50aGVuKChhcnRpc3RzTikgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gYXJ0aXN0c047XHJcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlRXJyb3IoZXJyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB2YXIgYXJ0aXN0c19jbGVhbiA9IFtdO1xyXG5cclxuICAgIGFydGlzdFdpdGhTb25nLmZvckVhY2goKGFydCkgPT4ge1xyXG4gICAgICAgIGFydGlzdHNfY2xlYW4ucHVzaChhcnQuX2lkKTtcclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGFydGlzdHM6IGFydGlzdHNfY2xlYW5cclxuICAgIH1cclxufVxyXG5cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cclxuICAgIHNvbmdTYXZlLFxyXG4gICAgZ2V0U29uZ3MsXHJcbiAgICBnZXRTb25nc1BhZ2luYXRpb24sXHJcbiAgICBnZXRTb25nLFxyXG4gICAgdXBkYXRlU29uZyxcclxuICAgIGRlbGV0ZVNvbmcsXHJcbiAgICBmaW5kQnlUaXR1bG9BbmRBcnRpc3RhXHJcblxyXG59Il19